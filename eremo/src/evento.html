<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eremo Frate Francesco - Eventi Spirituali</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<style>
    /* Layout migliorato */
    .event-card {
        max-width: 1280px;
        margin: 2rem auto;
        padding: 2rem;
        background: white;
        border-radius: 30px;
        box-shadow: 0 20px 50px rgba(0,0,0,0.08);
    }

    .main-grid {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 3rem;
        align-items: start;
    }

    /* Sezione sinistra - Contenuto principale */
    .event-details {
        padding-right: 3rem;
        border-right: 2px solid rgba(0,0,0,0.05);
    }

    /* Sezione destra - Prenotazione */
    .booking-column {
        position: sticky;
        top: 120px;
        height: fit-content;
    }

    .booking-panel {
        background: var(--gradient);
        border-radius: 25px;
        padding: 2.5rem;
        box-shadow: 0 15px 40px rgba(52,152,219,0.15);
    }

    /* Header migliorato */
    .event-header {
        margin-bottom: 3rem;
        text-align: center;
    }

    .event-title {
        font-size: 2.5rem;
        color: var(--primary);
        margin: 2rem 0 1rem;
        line-height: 1.2;
    }

    /* Grid informazioni */
    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }

    .info-card {
        background: rgba(241,242,246,0.4);
        padding: 1.5rem;
        border-radius: 15px;
        border: 1px solid rgba(0,0,0,0.05)
    }
    
    /* Sezione prenotazione */
    .booking-status {
        background: rgba(255,255,255,0.15);
        color: white;
        padding: 1rem;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        backdrop-filter: blur(5px);
        animation: status-pulse 2s infinite;
    }

    @keyframes status-pulse {
        0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.4); }
        100% { box-shadow: 0 0 0 15px rgba(255,255,255,0); }
    }

    .price-display {
        font-size: 3rem;
        color: white;
        text-align: center;
        margin: 2rem 0;
    }

    .meta-info {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .btn-reserve {
        width: 100%;
        padding: 1.2rem;
        font-size: 1.1rem;
        border-radius: 15px;
        background: rgba(255,255,255,0.9);
        color: var(--primary);
        transition: all 0.3s ease;
    }

    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .btn-reserve:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    /* Sezione commenti */
    .comments-section {
        margin-top: 4rem;
        padding-top: 3rem;
        border-top: 2px solid rgba(0,0,0,0.05);
    }

    @media (max-width: 1024px) {
        .main-grid {
            grid-template-columns: 1fr;
        }

        .event-details {
            padding-right: 0;
            border-right: none;
        }

        .booking-column {
            position: static;
        }
    }

    @media (max-width: 768px) {
        .event-card {
            padding: 1.5rem;
            border-radius: 20px;
        }

        .event-title {
            font-size: 2rem;
        }

        .info-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<body>
<header>
    <div class="navbar-container">
        <div class="navbar">
            <div class="logo">
                <span class="emoji">üèîÔ∏è</span>
                <a href="index.html" class="text">Eremo Frate Francesco</a>
            </div>
            <div class="menu">
                <a href="chi-siamo.html">Chi siamo</a>
                <a>!</a>
                <a href="contatti.html">Contatti</a>
                <a href="eventiincorso.html">Eventi in corso</a>
                <a href="eventi-passati.html">Eventi passati</a>
            </div>

            <!-- Contenitore Login + Hamburger -->
            <div class="right-menu">
                <a href="accedi" class="login">Accedi</a>
                <button class="hamburger" onclick="toggleMenu()" aria-expanded="false">‚ò∞</button>
            </div>
        </div>

        <!-- Menu Mobile -->
        <div class="mobile-menu" id="mobileMenu">
            <a href="chi-siamo.html" onclick="closeMenu()">Chi siamo</a>
            <a href="contatti.html" onclick="closeMenu()">Contatti</a>
            <a href="eventiincorso.html" onclick="closeMenu()">Eventi in corso</a>
            <a href="eventi-passati.html" onclick="closeMenu()">Eventi passati</a>
        </div>
    </div>
</header>



<div class="event-card">
    <div class="event-media">
        <img src="https://picsum.photos/1920/1080?random=1?natureleafgreen" alt="Event image" class="event-image" loading="lazy">
    </div>

    <div class="main-grid">
        <!-- Colonna sinistra -->
        <div class="event-details">
            <div class="event-header">
                <h1 class="event-title">Ritiro Meditativo nel Silenzio</h1>
                <div class="association-badge">Associazione: Cuori Spirituali</div>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <i class="fas fa-clock"></i>
                    <h4>Durata</h4>
                    <p>3 Giorni</p>
                    <small>15-17 Settembre 2024</small>
                </div>

                <div class="info-card">
                    <i class="fas fa-map-marker-alt"></i>
                    <h4>Location</h4>
                    <p>Eremo Frate Francesco</p>
                    <small>Monte Sereno, Italia</small>
                </div>

                <div class="info-card">
                    <i class="fas fa-users"></i>
                    <h4>Partecipanti</h4>
                    <p>Max 20 persone</p>
                    <small>Gruppo intimo</small>
                </div>

                <div class="info-card">
                    <i class="fas fa-concierge-bell"></i>
                    <h4>Servizi inclusi</h4>
                    <ul>
                        <li>Pensione completa</li>
                        <li>Materiale didattico</li>
                        <li>Assicurazione</li>
                    </ul>
                </div>
            </div>

            <div class="info-card" style="grid-column: 1 / -1">
                <i class="fas fa-book-open"></i>
                <h3>Descrizione</h3>
                <p class="description-text">Un viaggio rigenerante tra... [testo descrittivo]</p>
            </div>
        </div>

        <!-- Colonna destra -->
        <div class="booking-column">
            <div class="booking-panel">
                <div class="booking-status">
                    <i class="fas fa-lock-open"></i>
                    PRENOTAZIONI APERTE
                </div>

                <div class="price-display">
                    ‚Ç¨ 120<small>,00</small>
                </div>

                <div class="meta-info">
                    <span class="seats-available">
                        <i class="fas fa-chair"></i>
                        Posti disponibili:
                        <span class="count">20</span>/20 <!-- Modifica da 12 a 20 -->
                    </span>
                    <!-- Modifica il pulsante prenota nell'HTML -->
                    <button class="btn-reserve">
                        Prenota Ora
                        <i class="fas fa-spinner loading-spinner"></i>
                    </button>
                    </button>
                </div>
            </div>
        </div>
    </div>

        <div class="comments-section">
            <div class="comment-form">
                <h4>Condividi la tua esperienza</h4>
                <div class="comment-form-container">
                    <textarea placeholder="Scrivi qui il tuo commento..."></textarea>
                    <button class="btn-comment" id="main-comment-btn">
                        <i class="fas fa-paper-plane"></i>
                        Pubblica
                    </button>
                </div>
            </div>

            <div class="comments-list">
                <div class="comment">
                    <div class="comment-header">
                        <img src="https://www.gravatar.com/avatar/000?d=retro&s=45"
                             class="user-avatar">
                        <div>
                            <strong>Maria Pace</strong>
                            <small>2 ore fa</small>
                        </div>
                    </div>
                    <p>Un'esperienza che rigenera l'anima üåø</p>

                    <div class="like-system">
                        <button class="like-btn">
                            <i class="fas fa-heart"></i> <span>12</span>
                        </button>
                    </div>

                    <div class="comment-actions">
                        <button class="btn-reply">
                            <i class="fas fa-reply"></i>
                            Rispondi
                        </button>
                    </div>

                    <div class="reply-form">
                        <textarea placeholder="Scrivi la tua risposta..."></textarea>
                        <button class="btn-comment">
                            <i class="fas fa-paper-plane"></i>
                            Invia risposta
                        </button>
                    </div>

                    <div class="replies">
                            <div class="reply-form">
                                <textarea placeholder="Scrivi la tua risposta..."></textarea>
                                <button class="btn-comment">
                                    <i class="fas fa-paper-plane"></i>
                                    Invia risposta
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    function toggleMenu() {
        const menu = document.getElementById("mobileMenu");
        const button = document.querySelector(".hamburger");
        const isOpen = menu.classList.toggle("open");
        button.classList.toggle("open");
        button.setAttribute("aria-expanded", isOpen);
    }

    function closeMenu() {
        document.getElementById("mobileMenu").classList.remove("open");
        document.querySelector(".hamburger").classList.remove("open");
        document.querySelector(".hamburger").setAttribute("aria-expanded", "false");
    }

    // Chiudi il menu mobile quando si passa alla modalit√† desktop
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            closeMenu();
        }
    });
</script>

<script>
    // Configurazione iniziale
    const eventId = 1;
    const totalSeats = 20; // Aggiornato a 20 posti totali
    const currentUser = {
        id: 1,
        name: "Ospite",
        email: "ospite@eremo.it",
        avatar: getGravatar("ospite@eremo.it")
    };

    // Inizializzazione
    document.addEventListener('DOMContentLoaded', () => {
        initEvent(eventId);

        // Delegazione eventi
        document.querySelector('.comment-form .btn-comment').addEventListener('click', () => addComment(false));
        document.querySelector('.btn-reserve').addEventListener('click', handleReservation);

        document.querySelector('.comments-list').addEventListener('click', function(e) {
            if(e.target.closest('.like-btn')) handleReaction(e);
            if(e.target.closest('.btn-reply')) toggleReplyForm(e);
            if(e.target.closest('.reply-form .btn-comment')) submitReply(e.target.closest('.btn-comment'));
        });
    });

    function handleReservation() {
        const btn = document.querySelector('.btn-reserve');
        const seatsElement = document.querySelector('.seats-available .count');
        let currentSeats = parseInt(seatsElement.textContent);
        const spinner = btn.querySelector('.fa-spinner');

        if(currentSeats > 0 && !btn.disabled) {
            btn.disabled = true;
            spinner.style.display = 'inline-block';

            // Simula chiamata API
            setTimeout(() => {
                try {
                    currentSeats--;
                    seatsElement.textContent = currentSeats;

                    // Aggiorna localStorage
                    const reservations = JSON.parse(localStorage.getItem('reservations') || '{}');
                    reservations[eventId] = (totalSeats - currentSeats);
                    localStorage.setItem('reservations', JSON.stringify(reservations));

                    // Animazione
                    seatsElement.classList.add('pulse-alert');
                    setTimeout(() => seatsElement.classList.remove('pulse-alert'), 1000);

                    // Disabilita bottone se esauriti
                    if(currentSeats <= 0) {
                        btn.disabled = true;
                        document.querySelector('.booking-status').innerHTML = `
                            <i class="fas fa-lock"></i>
                            PRENOTAZIONI ESAURITE
                        `;
                    }
                } catch (error) {
                    console.error('Errore prenotazione:', error);
                    seatsElement.textContent = currentSeats + 1;
                } finally {
                    btn.disabled = false;
                    spinner.style.display = 'none';
                }
            }, 800);
        }
    }

    // Funzione init aggiornata
    function initEvent(eventId) {
        const reservations = JSON.parse(localStorage.getItem('reservations') || '{}');
        const reserved = reservations[eventId] || 0;
        const initialSeats = totalSeats - reserved; // Usa totalSeats invece di 100

        const seatsElement = document.querySelector('.seats-available .count');
        seatsElement.textContent = initialSeats;

        // Aggiorna stato prenotazioni
        if(initialSeats <= 0) {
            document.querySelector('.booking-status').innerHTML = `
            <i class="fas fa-lock"></i>
            PRENOTAZIONI ESAURITE
        `;
            document.querySelector('.btn-reserve').disabled = true;
        }
    }


    // Template commento
    const commentTemplate = (username, avatar, content, timestamp) => `
    <div class="comment">
        <div class="comment-header">
            <img src="${avatar}" class="user-avatar">
            <div>
                <strong>${username}</strong>
                <small>${timestamp}</small>
            </div>
        </div>
        <p>${content}</p>

        <div class="like-system">
            <button class="like-btn">
                <i class="fas fa-heart"></i> <span>0</span>
            </button>
        </div>

        <div class="comment-actions">
            <button class="btn-reply">
                <i class="fas fa-reply"></i>
                Rispondi
            </button>
        </div>

        <div class="reply-form">
            <textarea placeholder="Scrivi la tua risposta..."></textarea>
            <button class="btn-comment">
                <i class="fas fa-paper-plane"></i>
                Invia risposta
            </button>
        </div>

        <div class="replies"></div>
    </div>
`;

    // Funzione principale per aggiungere commenti
    function addComment(isReply = false, parentElement = null) {
        let textarea;
        if(isReply && parentElement) {
            textarea = parentElement.querySelector('.reply-form textarea');
        } else {
            textarea = document.querySelector('.comment-form textarea');
        }

        if(textarea.value.trim()) {
            const timestamp = new Date().toLocaleString('it-IT', {
                hour: '2-digit',
                minute: '2-digit',
                day: 'numeric',
                month: 'short'
            });

            const newComment = document.createElement('div');
            newComment.innerHTML = commentTemplate(
                currentUser.name,
                currentUser.avatar,
                textarea.value.trim(),
                timestamp
            );

            const targetContainer = isReply
                ? parentElement.querySelector('.replies')
                : document.querySelector('.comments-list');

            targetContainer.appendChild(newComment);
            textarea.value = '';

            if(isReply) {
                parentElement.querySelector('.reply-form').classList.remove('active');
            }
        }
    }

    // Gestione risposte
    function toggleReplyForm(e) {
        const comment = e.target.closest('.comment');
        const replyForm = comment.querySelector('.reply-form');
        replyForm.classList.toggle('active');

        if(replyForm.classList.contains('active')) {
            replyForm.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            replyForm.querySelector('textarea').focus();
        }
    }

    function submitReply(btn) {
        const replyForm = btn.closest('.reply-form');
        addComment(true, replyForm.closest('.comment'));
    }

    // Gestione like/dislike
    function handleReaction(e) {
        const btn = e.target.closest('.like-btn');
        const countSpan = btn.querySelector('span');
        const isLike = btn.classList.contains('like-btn');
        const currentCount = parseInt(countSpan.textContent);

        if(btn.classList.contains('active')) {
            countSpan.textContent = currentCount - 1;
            btn.classList.remove('active');
        } else {
            const oppositeBtn = btn.parentElement.querySelector('.like-btn');
            if(oppositeBtn.classList.contains('active')) {
                const oppositeCount = parseInt(oppositeBtn.querySelector('span').textContent);
                oppositeBtn.querySelector('span').textContent = oppositeCount - 1;
                oppositeBtn.classList.remove('active');
            }

            countSpan.textContent = currentCount + 1;
            btn.classList.add('active');
        }
    }

    // Funzioni helper
    function getGravatar(email, size=40) {
        const hash = CryptoJS.MD5(email.trim().toLowerCase());
        return `https://www.gravatar.com/avatar/${hash}?s=${size}&d=retro`;
    }

</script>
<footer>
    <p>&copy; 2025 Eremo Frate Francesco. Tutti i diritti riservati.</p>
</footer>
</body>
</html>