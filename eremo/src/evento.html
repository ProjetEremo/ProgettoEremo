<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eremo Frate Francesco - Eventi Spirituali</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <div class="navbar-container">
        <div class="navbar">
            <div class="logo">
                <span class="emoji">üèîÔ∏è</span>
                <span class="text">Eremo Frate Francesco</span>
            </div>
            <div class="menu">
                <a href="#chi-siamo.html">Chi siamo</a>
                <a href="#contatti.html">Contatti</a>
                <a href="#eventi-corso.html">Eventi in corso</a>
                <a href="#eventi-passati.html">Eventi passati</a>
            </div>

            <!-- Contenitore Login + Hamburger -->
            <div class="right-menu">
                <a href="#accedi" class="login">Accedi</a>
                <button class="hamburger" onclick="toggleMenu()" aria-expanded="false">‚ò∞</button>
            </div>
        </div>

        <!-- Menu Mobile -->
        <div class="mobile-menu" id="mobileMenu">
            <a href="#chi-siamo.html" onclick="closeMenu()">Chi siamo</a>
            <a href="#contatti.html" onclick="closeMenu()">Contatti</a>
            <a href="#eventi-corso.html" onclick="closeMenu()">Eventi in corso</a>
            <a href="#eventi-passati.html" onclick="closeMenu()">Eventi passati</a>
        </div>
    </div>
</header>



<div class="event-card">
    <div class="event-media">
        <img src="images/meditation.jpg"
             alt="Event image"
             class="event-image"
             loading="lazy">
    </div>

    <div class="event-details">
        <h2>Ritiro Meditativo nel Silenzio</h2>

        <div class="meta-info">
                <span class="seats-available">
                    Posti disponibili: <span class="count">78</span>
                </span>
            <button class="btn-reserve">
                Prenota Ora
                <i class="fas fa-spinner loading-spinner"></i>
            </button>
        </div>

        <div class="presenters">
            <h3>Guide Spirituali:</h3>
            <p>Fra Antonio, Suor Maria, Padre Riccardo</p>
        </div>

        <div class="target-audience">
            <h3>A chi √® rivolto:</h3>
            <p>Cercatori di pace interiore e contemplazione</p>
        </div>

        <div class="comments-section">
            <div class="comment-form">
                <h4>Condividi la tua esperienza</h4>
                <div class="comment-form-container">
                    <textarea placeholder="Scrivi qui il tuo commento..."></textarea>
                    <button class="btn-comment" id="main-comment-btn">
                        <i class="fas fa-paper-plane"></i>
                        Pubblica
                    </button>
                </div>
            </div>

            <div class="comments-list">
                <div class="comment">
                    <div class="comment-header">
                        <img src="https://www.gravatar.com/avatar/000?d=retro&s=45"
                             class="user-avatar">
                        <div>
                            <strong>Maria Pace</strong>
                            <small>2 ore fa</small>
                        </div>
                    </div>
                    <p>Un'esperienza che rigenera l'anima üåø</p>

                    <div class="like-system">
                        <button class="like-btn">
                            <i class="fas fa-heart"></i> <span>12</span>
                        </button>
                    </div>

                    <div class="comment-actions">
                        <button class="btn-reply">
                            <i class="fas fa-reply"></i>
                            Rispondi
                        </button>
                    </div>

                    <div class="reply-form">
                        <textarea placeholder="Scrivi la tua risposta..."></textarea>
                        <button class="btn-comment">
                            <i class="fas fa-paper-plane"></i>
                            Invia risposta
                        </button>
                    </div>

                    <div class="replies">
                            <div class="reply-form">
                                <textarea placeholder="Scrivi la tua risposta..."></textarea>
                                <button class="btn-comment">
                                    <i class="fas fa-paper-plane"></i>
                                    Invia risposta
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    function toggleMenu() {
        const menu = document.getElementById('mobileMenu');
        menu.classList.toggle('open');
    }

    function closeMenu() {
        const menu = document.getElementById('mobileMenu');
        menu.classList.remove('open');
    }

    // Chiudi il menu mobile quando si passa alla modalit√† desktop
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            closeMenu();
        }
    });
</script>

<script>
    // Configurazione iniziale
    const eventId = 1;
    const currentUser = {
        id: 1,
        name: "Ospite",
        email: "ospite@eremo.it",
        avatar: getGravatar("ospite@eremo.it")
    };

    // Inizializzazione
    document.addEventListener('DOMContentLoaded', () => {
        initEvent(eventId);

        // Gestione commento principale
        document.querySelector('.comment-form .btn-comment').addEventListener('click', () => addComment(false));
        document.querySelector('.btn-reserve').addEventListener('click', handleReservation);

        // Delegazione eventi per commenti dinamici
        document.querySelector('.comments-list').addEventListener('click', function(e) {
            // Gestione like/dislike
            if(e.target.closest('.like-btn')) {
                handleReaction(e);
            }
            // Gestione risposte
            if(e.target.closest('.btn-reply')) {
                toggleReplyForm(e);
            }
            // Gestione invio risposte
            if(e.target.closest('.reply-form .btn-comment')) {
                submitReply(e.target.closest('.btn-comment'));
            }
        });
    });



function handleReservation() {
        const btn = document.querySelector('.btn-reserve');
        const seatsElement = document.querySelector('.seats-available .count');
        const currentSeats = parseInt(seatsElement.textContent);
        const spinner = btn.querySelector('.loading-spinner');

        if(currentSeats > 0 && !btn.disabled) {
            btn.disabled = true;
            spinner.style.display = 'inline-block';

            setTimeout(() => {
                try {
                    seatsElement.textContent = currentSeats - 1;
                    const reservations = JSON.parse(localStorage.getItem('reservations') || '{}');
                    reservations[eventId] = (reservations[eventId] || 0) + 1;
                    localStorage.setItem('reservations', JSON.stringify(reservations));

                    // Animazione conferma
                    seatsElement.classList.add('pulse-alert');
                    setTimeout(() => seatsElement.classList.remove('pulse-alert'), 1000);

                } catch (error) {
                    console.error('Errore prenotazione:', error);
                    seatsElement.textContent = currentSeats;
                } finally {
                    btn.disabled = false;
                    spinner.style.display = 'none';
                }
            }, 800);
        }
    }


    // Template commento
    const commentTemplate = (username, avatar, content, timestamp) => `
    <div class="comment">
        <div class="comment-header">
            <img src="${avatar}" class="user-avatar">
            <div>
                <strong>${username}</strong>
                <small>${timestamp}</small>
            </div>
        </div>
        <p>${content}</p>

        <div class="like-system">
            <button class="like-btn">
                <i class="fas fa-heart"></i> <span>0</span>
            </button>
        </div>

        <div class="comment-actions">
            <button class="btn-reply">
                <i class="fas fa-reply"></i>
                Rispondi
            </button>
        </div>

        <div class="reply-form">
            <textarea placeholder="Scrivi la tua risposta..."></textarea>
            <button class="btn-comment">
                <i class="fas fa-paper-plane"></i>
                Invia risposta
            </button>
        </div>

        <div class="replies"></div>
    </div>
`;

    // Funzione principale per aggiungere commenti
    function addComment(isReply = false, parentElement = null) {
        let textarea;
        if(isReply && parentElement) {
            textarea = parentElement.querySelector('.reply-form textarea');
        } else {
            textarea = document.querySelector('.comment-form textarea');
        }

        if(textarea.value.trim()) {
            const timestamp = new Date().toLocaleString('it-IT', {
                hour: '2-digit',
                minute: '2-digit',
                day: 'numeric',
                month: 'short'
            });

            const newComment = document.createElement('div');
            newComment.innerHTML = commentTemplate(
                currentUser.name,
                currentUser.avatar,
                textarea.value.trim(),
                timestamp
            );

            const targetContainer = isReply
                ? parentElement.querySelector('.replies')
                : document.querySelector('.comments-list');

            targetContainer.appendChild(newComment);
            textarea.value = '';

            if(isReply) {
                parentElement.querySelector('.reply-form').classList.remove('active');
            }
        }
    }

    // Gestione risposte
    function toggleReplyForm(e) {
        const comment = e.target.closest('.comment');
        const replyForm = comment.querySelector('.reply-form');
        replyForm.classList.toggle('active');

        if(replyForm.classList.contains('active')) {
            replyForm.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            replyForm.querySelector('textarea').focus();
        }
    }

    function submitReply(btn) {
        const replyForm = btn.closest('.reply-form');
        addComment(true, replyForm.closest('.comment'));
    }

    // Gestione like/dislike
    function handleReaction(e) {
        const btn = e.target.closest('.like-btn');
        const countSpan = btn.querySelector('span');
        const isLike = btn.classList.contains('like-btn');
        const currentCount = parseInt(countSpan.textContent);

        if(btn.classList.contains('active')) {
            countSpan.textContent = currentCount - 1;
            btn.classList.remove('active');
        } else {
            const oppositeBtn = btn.parentElement.querySelector('.like-btn');
            if(oppositeBtn.classList.contains('active')) {
                const oppositeCount = parseInt(oppositeBtn.querySelector('span').textContent);
                oppositeBtn.querySelector('span').textContent = oppositeCount - 1;
                oppositeBtn.classList.remove('active');
            }

            countSpan.textContent = currentCount + 1;
            btn.classList.add('active');
        }
    }

    // Funzioni helper
    function getGravatar(email, size=40) {
        const hash = CryptoJS.MD5(email.trim().toLowerCase());
        return `https://www.gravatar.com/avatar/${hash}?s=${size}&d=retro`;
    }

    function initEvent(eventId) {
        const reservations = JSON.parse(localStorage.getItem('reservations') || '{}');
        const initialSeats = 100 - (reservations[eventId] || 0);
        document.querySelector('.seats-available .count').textContent = initialSeats;
    }

    function toggleMenu() {
        const menu = document.getElementById("mobileMenu");
        const button = document.querySelector(".hamburger");
        const isOpen = menu.classList.toggle("open");
        button.classList.toggle("open");
        button.setAttribute("aria-expanded", isOpen);
    }

    function closeMenu() {
        document.getElementById("mobileMenu").classList.remove("open");
        document.querySelector(".hamburger").classList.remove("open");
        document.querySelector(".hamburger").setAttribute("aria-expanded", "false");
    }
</script>
</body>
</html>