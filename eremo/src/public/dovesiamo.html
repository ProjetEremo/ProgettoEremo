<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dove Siamo - Eremo Frate Francesco</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="navbar-container" id="navbarContainer">
      <nav class="navbar">
        <div class="logo">
          <a href="index.html"
            ><span class="emoji">üèîÔ∏è</span>
            <h2>Eremo Frate Francesco</h2></a
          >
        </div>
        <div class="menu">
          <a href="eventiincorso.html">Calendario attivit√†</a>
          <a href="eventipassati.html">Archivio attivit√†</a
          ><span class="separator">|</span>
          <a href="incontrisullaparola.html">Incontri sulla parola</a
          ><span class="separator">|</span>
          <a href="dovesiamo.html" class="active">Dove siamo</a>
          <a href="contatti.html">Contatti</a>
        </div>
        <div class="right-menu">
          <button id="login-btn" class="login-btn">Accedi</button>
          <button
            class="hamburger"
            onclick="toggleMobileMenu()"
            aria-label="Toggle menu"
          >
            ‚ò∞
          </button>
        </div>
      </nav>
      <div class="mobile-menu" id="mobileMenu">
        <a href="eventiincorso.html" onclick="closeMobileMenu()"
          >Calendario attivit√†</a
        >
        <a href="eventipassati.html" onclick="closeMobileMenu()"
          >Archivio attivit√†</a
        >
        <a href="incontrisullaparola.html" onclick="closeMobileMenu()"
          >Incontri sulla parola</a
        >
        <a href="dovesiamo.html" onclick="closeMobileMenu()">Dove siamo</a>
        <a href="contatti.html" onclick="closeMobileMenu()">Contatti</a>
        <a
          href="#"
          id="login-btn-mobile"
          onclick="openLoginPopup(); closeMobileMenu();"
          >Accedi</a
        >
      </div>
    </header>

    <main>
      <div class="container section-padding pb-0"><h1>Dove Siamo</h1></div>

      <div class="container section-padding pt-0">
        <section class="map-section">
          <div class="map-container">
            <iframe
              class="iframe-map"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2790.058748708788!2d9.74509967689635!3d45.76234431152889!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4781578677fd3443%3A0x3e16338c4c9e9fed!2sNembro%20-%20via%20s.vito%20(chiesa)!5e0!3m2!1sit!2sit!4v1713908889123!5m2!1sit!2sit"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Mappa Eremo Frate Francesco"
            >
            </iframe>
          </div>
          <div class="location-description">
            <h2>Raggiungici a San Vito di Nembro</h2>
            <p>
              L'Eremo Frate Francesco si trova in una posizione tranquilla e
              suggestiva, ideale per il raccoglimento, nella frazione di San
              Vito a Nembro (BG).
            </p>
            <p>
              <strong>Indirizzo:</strong> Via San Vito, 24027 Nembro BG (Presso
              la Chiesa di San Vito)
            </p>
            <p>
              <strong>Indicazioni:</strong> Dalla SP35, seguire per Nembro
              centro e poi per San Vito. L'eremo si trova nella parte alta della
              frazione.
            </p>
            <p><strong>Parcheggio:</strong> Disponibile nelle vicinanze.</p>
            <div class="location-actions">
              <a
                href="https://www.google.com/maps/dir//Nembro+-+via+s.vito+(chiesa),+24027+Nembro+BG/@45.76234,9.7451251,17z/data=!4m9!4m8!1m0!1m5!1m1!1s0x4781578677fd3443:0x3e16338c4c9e9fed!2m2!1d9.7477!2d45.76234!3e0?entry=ttu"
                target="_blank"
                rel="noopener noreferrer"
                class="btn-primary"
              >
                <i class="fas fa-directions"></i> Indicazioni
              </a>
              <a href="contatti.html" class="btn-secondary">
                <i class="fas fa-envelope"></i> Contattaci
              </a>
            </div>
          </div>
        </section>

        <section class="location-info-cards">
          <h2 class="text-center mb-4">Informazioni Utili</h2>
          <div class="card-grid">
            <div class="card">
              <div class="card-content">
                <h3><i class="fas fa-clock"></i> Orari</h3>
                <p>
                  L'accesso all'Eremo √® legato alle attivit√† programmate. Per
                  visite o ritiri personali, √® necessario contattarci
                  preventivamente.
                </p>
                <p>
                  Le celebrazioni seguono orari specifici (consultare
                  <a href="eventiincorso.html">calendario</a>).
                </p>
              </div>
            </div>
            <div class="card">
              <div class="card-content">
                <h3><i class="fas fa-phone-alt"></i> Contatti Rapidi</h3>
                <p>Per info su attivit√†, ritiri o ospitalit√†:</p>
                <p>
                  <strong>Tel:</strong> +39 123 456789<br />
                  <strong>Email:</strong> info@eremo.it
                </p>
                <a
                  href="contatti.html"
                  class="card-btn card-btn-secondary"
                  style="margin-top: 1rem"
                  >Vedi tutti i contatti</a
                >
              </div>
            </div>
            <div class="card">
              <div class="card-content">
                <h3><i class="fas fa-wheelchair"></i> Accessibilit√†</h3>
                <p>
                  L'area presenta percorsi con pendenze. Per esigenze specifiche
                  di accessibilit√†, vi preghiamo di contattarci per discutere le
                  possibilit√†.
                </p>
                <p>Faremo il possibile per accogliervi al meglio.</p>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <div class="login-popup-overlay" id="loginOverlay"></div>
    <div class="login-popup" id="loginPopup">
      <button class="close-popup" id="closePopup" aria-label="Chiudi popup">
        &times;
      </button>
      <div class="login-tabs">
        <div class="login-tab active" data-tab="login">Accedi</div>
        <div class="login-tab" data-tab="register">Registrati</div>
      </div>
      <form class="login-form active" id="loginForm" method="POST">
        <div class="form-group mb-3">
          <label for="login-email">Email</label>
          <input
            type="email"
            id="login-email"
            name="login-email"
            class="form-control"
            required
            autocomplete="email"
          />
        </div>
        <div class="form-group mb-3">
          <label for="login-password">Password</label>
          <input
            type="password"
            id="login-password"
            name="login-password"
            class="form-control"
            required
            autocomplete="current-password"
          />
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-popup">Accedi</button>
        </div>
      </form>
      <form class="login-form" id="registerForm" method="POST">
        <div class="form-group mb-3">
          <label for="register-name">Nome</label>
          <input
            type="text"
            id="register-name"
            name="register-name"
            class="form-control"
            required
            autocomplete="given-name"
          />
        </div>
        <div class="form-group mb-3">
          <label for="register-surname">Cognome</label>
          <input
            type="text"
            id="register-surname"
            name="register-surname"
            class="form-control"
            required
            autocomplete="family-name"
          />
        </div>
        <div class="form-group mb-3">
          <label for="register-email">Email</label>
          <input
            type="email"
            id="register-email"
            name="register-email"
            class="form-control"
            required
            autocomplete="email"
          />
        </div>
        <div class="form-group mb-3">
          <label for="register-password">Password</label>
          <input
            type="password"
            id="register-password"
            name="register-password"
            class="form-control"
            required
            minlength="8"
            autocomplete="new-password"
          />
          <small>Minimo 8 caratteri.</small>
        </div>
        <div class="terms-checkbox mb-3">
          <input
            type="checkbox"
            id="register-terms"
            name="register-terms"
            required
          />
          <label for="register-terms"
            >Accetto i
            <a href="termini.html" target="_blank">termini e condizioni</a></label
          >
        </div>
        <div class="form-actions">
          <button type="submit" class="btn-popup">Registrati</button>
        </div>
      </form>
    </div>
    <div class="menu">
      <a href="eventiincorso.html">Calendario attivit√†</a>
      <a href="eventipassati.html">Archivio attivit√†</a
      ><span class="separator">|</span>
      <a href="incontrisullaparola.html">Incontri sulla parola</a
      ><span class="separator">|</span>
      <a href="dovesiamo.html" class="active">Dove siamo</a>
      <a href="contatti.html">Contatti</a>
    </div>
    <div class="right-menu">
      <button id="login-btn" class="login-btn">Accedi</button>
      <button
              class="hamburger"
              onclick="toggleMobileMenu()"
              aria-label="Toggle menu"
      >
        ‚ò∞
      </button>
    </div>
  </nav>
  <div class="mobile-menu" id="mobileMenu">
    <a href="eventiincorso.html" onclick="closeMobileMenu()"
    >Calendario attivit√†</a
    >
    <a href="eventipassati.html" onclick="closeMobileMenu()"
    >Archivio attivit√†</a
    >
    <a href="incontrisullaparola.html" onclick="closeMobileMenu()"
    >Incontri sulla parola</a
    >
    <a href="dovesiamo.html" onclick="closeMobileMenu()">Dove siamo</a>
    <a href="contatti.html" onclick="closeMobileMenu()">Contatti</a>
    <a
            href="#"
            id="login-btn-mobile"
            onclick="openLoginPopup(); closeMobileMenu();"
    >Accedi</a
    >
  </div>
</header>

<main>
  <div class="container section-padding pb-0"><h1>Dove Siamo</h1></div>

  <div class="container section-padding pt-0">
    <section class="map-section">
      <div class="map-container">
        <iframe
                class="iframe-map"
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2789.726565080011!2d9.764753015573094!3d45.73689917910574!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4781500767b61a2b%3A0x501071be12e6a613!2sChiesa%20di%20San%20Vito%20Martire!5e0!3m2!1sit!2sit!4v1678886000000!5m2!1sit!2sit" /* Esempio URL Mappa Reale */
        allowfullscreen=""
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
        title="Mappa Eremo Frate Francesco"
        >
        </iframe>
      </div>
      <div class="location-description">
        <h2>Raggiungici a San Vito di Nembro</h2>
        <p>
          L'Eremo Frate Francesco si trova in una posizione tranquilla e
          suggestiva, ideale per il raccoglimento, nella frazione di San
          Vito a Nembro (BG).
        </p>
        <p>
          <strong>Indirizzo:</strong> Via San Vito, 24027 Nembro BG (Presso
          la Chiesa di San Vito)
        </p>
        <p>
          <strong>Indicazioni:</strong> Dalla SP35, seguire per Nembro
          centro e poi per San Vito. L'eremo si trova nella parte alta della
          frazione.
        </p>
        <p><strong>Parcheggio:</strong> Disponibile nelle vicinanze.</p>
        <div class="location-actions">
          <a
                  href="https://www.google.com/maps/dir/?api=1&destination=Chiesa+San+Vito+Nembro" /* Esempio URL Indicazioni */
          target="_blank"
          rel="noopener noreferrer"
          class="btn-primary"
          >
          <i class="fas fa-directions"></i> Indicazioni
          </a>
          <a href="contatti.html" class="btn-secondary">
            <i class="fas fa-envelope"></i> Contattaci
          </a>
        </div>
      </div>
    </section>

    <section class="location-info-cards">
      <h2 class="text-center mb-4">Informazioni Utili</h2>
      <div class="card-grid">
        <div class="card">
          <div class="card-content">
            <h3><i class="fas fa-clock"></i> Orari</h3>
            <p>
              L'accesso all'Eremo √® legato alle attivit√† programmate. Per
              visite o ritiri personali, √® necessario contattarci
              preventivamente.
            </p>
            <p>
              Le celebrazioni seguono orari specifici (consultare
              <a href="eventiincorso.html">calendario</a>).
            </p>
          </div>
        </div>
        <div class="card">
          <div class="card-content">
            <h3><i class="fas fa-phone-alt"></i> Contatti Rapidi</h3>
            <p>Per info su attivit√†, ritiri o ospitalit√†:</p>
            <p>
              <strong>Tel:</strong> +39 123 456789<br />
              <strong>Email:</strong> info@eremo.it
            </p>
            <a
                    href="contatti.html"
                    class="card-btn card-btn-secondary"
                    style="margin-top: 1rem"
            >Vedi tutti i contatti</a
            >
          </div>
        </div>
        <div class="card">
          <div class="card-content">
            <h3><i class="fas fa-wheelchair"></i> Accessibilit√†</h3>
            <p>
              L'area presenta percorsi con pendenze. Per esigenze specifiche
              di accessibilit√†, vi preghiamo di contattarci per discutere le
              possibilit√†.
            </p>
            <p>Faremo il possibile per accogliervi al meglio.</p>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>

<div class="login-popup-overlay" id="loginOverlay"></div>
<div class="login-popup" id="loginPopup">
  <button class="close-popup" id="closePopup" aria-label="Chiudi popup">
    &times;
  </button>
  <div class="login-tabs">
    <div class="login-tab active" data-tab="login">Accedi</div>
    <div class="login-tab" data-tab="register">Registrati</div>
  </div>
  <form class="login-form active" id="loginForm" method="POST">
    <div class="form-group mb-3">
      <label for="login-email">Email</label>
      <input
              type="email"
              id="login-email"
              name="login-email"
              class="form-control"
              required
              autocomplete="email"
      />
    </div>
    <div class="form-group mb-3">
      <label for="login-password">Password</label>
      <input
              type="password"
              id="login-password"
              name="login-password"
              class="form-control"
              required
              autocomplete="current-password"
      />
    </div>
    <div id="login-error-message" class="form-message error" style="display: none; margin-bottom: 1rem;"></div>
    <div class="form-actions">
      <button type="submit" class="btn-popup">Accedi</button>
    </div>
  </form>
  <form class="login-form" id="registerForm" method="POST">
    <div class="form-group mb-3">
      <label for="register-name">Nome</label>
      <input
              type="text"
              id="register-name"
              name="register-name"
              class="form-control"
              required
              autocomplete="given-name"
      />
    </div>
    <div class="form-group mb-3">
      <label for="register-surname">Cognome</label>
      <input
              type="text"
              id="register-surname"
              name="register-surname"
              class="form-control"
              required
              autocomplete="family-name"
      />
    </div>
    <div class="form-group mb-3">
      <label for="register-email">Email</label>
      <input
              type="email"
              id="register-email"
              name="register-email"
              class="form-control"
              required
              autocomplete="email"
      />
    </div>
    <div class="form-group mb-3">
      <label for="register-password">Password</label>
      <input
              type="password"
              id="register-password"
              name="register-password"
              class="form-control"
              required
              minlength="8"
              autocomplete="new-password"
      />
      <small>Minimo 8 caratteri.</small>
    </div>
    <div class="terms-checkbox mb-3">
      <input
              type="checkbox"
              id="register-terms"
              name="register-terms"
              required
      />
      <label for="register-terms"
      >Accetto i
        <a href="/termini" target="_blank">termini e condizioni</a></label
      >
    </div>
    <div id="register-error-message" class="form-message error" style="display: none; margin-bottom: 1rem;"></div>
    <div class="form-actions">
      <button type="submit" class="btn-popup">Registrati</button>
    </div>
  </form>
</div>

<footer>
  <p>¬© <span id="currentYear"></span> Eremo Frate Francesco. Tutti i diritti riservati. Via della Spiritualit√† 123, Nembro (BG) - Italia</p>
</footer>

<script>
  const defaultUserIconPath = '/uploads/icons/default_user.png'; // Definisci icona di default

  // --- Navbar Scroll Logic ---
  let lastScroll = 0;
  const navbarContainer = document.getElementById("navbarContainer");
  if (navbarContainer) {
    window.addEventListener(
            "scroll",
            function () {
              const currentScroll =
                      window.pageYOffset || document.documentElement.scrollTop;
              if (currentScroll <= 50) {
                navbarContainer.classList.remove("hidden");
                lastScroll = 0;
                return;
              }
              if (
                      currentScroll > lastScroll &&
                      !navbarContainer.classList.contains("hidden")
              ) {
                navbarContainer.classList.add("hidden");
              } else if (
                      currentScroll < lastScroll &&
                      navbarContainer.classList.contains("hidden")
              ) {
                navbarContainer.classList.remove("hidden");
              }
              lastScroll = currentScroll;
            },
            false
    );
  }

  // --- Mobile Menu Logic ---
  const mobileMenu = document.getElementById("mobileMenu");
  const hamburger = document.querySelector(".navbar .hamburger"); // Selettore pi√π specifico
  function toggleMobileMenu() {
    if (mobileMenu && hamburger) { // Aggiunto controllo
      const isOpen = mobileMenu.classList.toggle("open");
      hamburger.classList.toggle("open");
      hamburger.setAttribute("aria-expanded", String(isOpen));
      document.body.style.overflow = isOpen ? "hidden" : "";
    }
  }
  function closeMobileMenu() {
    if (mobileMenu && hamburger && mobileMenu.classList.contains("open")) { // Aggiunto controllo
      mobileMenu.classList.remove("open");
      hamburger.classList.remove("open");
      hamburger.setAttribute("aria-expanded", "false");
      document.body.style.overflow = "";
    }
  }
  if (hamburger) hamburger.addEventListener("click", toggleMobileMenu);

  document.querySelectorAll("#mobileMenu a").forEach((link) => {
    if (link.id !== 'login-btn-mobile') {
      link.addEventListener("click", closeMobileMenu);
    }
  });
  document.addEventListener("click", function (event) {
    if (
            mobileMenu && mobileMenu.classList.contains("open") &&
            hamburger && !mobileMenu.contains(event.target) &&
            !hamburger.contains(event.target)
    ) {
      closeMobileMenu();
    }
  });

  // --- Login Popup Logic ---
  const loginBtn = document.getElementById("login-btn");
  const loginBtnMobile = document.getElementById("login-btn-mobile");
  const loginOverlay = document.getElementById("loginOverlay");
  const loginPopup = document.getElementById("loginPopup");
  const closePopupBtn = document.getElementById("closePopup");
  const loginTabs = document.querySelectorAll(".login-tab");
  const loginForms = document.querySelectorAll(".login-popup .login-form"); // Selettore pi√π generico
  const loginErrorMessage = document.getElementById('login-error-message');
  const registerErrorMessage = document.getElementById('register-error-message');


  function openLoginPopup() {
    if(loginOverlay) loginOverlay.classList.add("active");
    if(loginPopup) loginPopup.classList.add("active");
    document.body.style.overflow = "hidden";
    resetFormErrors();
    const activeForm = loginPopup?.querySelector(".login-form.active");
    activeForm?.querySelector('input:not([type="hidden"])')?.focus();

  }

  function closeLoginPopup() {
    if(loginOverlay) loginOverlay.classList.remove("active");
    if(loginPopup) loginPopup.classList.remove("active");
    document.body.style.overflow = "";
    resetFormErrors();
  }

  function resetFormErrors() {
    loginForms.forEach(form => {
      form.querySelectorAll('.form-control.error-border').forEach(input => input.classList.remove('error-border'));
    });
    if (loginErrorMessage) loginErrorMessage.style.display = 'none';
    if (registerErrorMessage) registerErrorMessage.style.display = 'none';
  }

  if (loginBtn) {
    loginBtn.addEventListener("click", (e) => {
      e.preventDefault();
      openLoginPopup();
    });
  }
  // loginBtnMobile ha gi√† onclick nell'HTML

  if (closePopupBtn) {
    closePopupBtn.addEventListener("click", closeLoginPopup);
  }
  if (loginOverlay) {
    loginOverlay.addEventListener("click", (e) => { // Modificato per chiudere solo su click overlay
      if (e.target === loginOverlay) {
        closeLoginPopup();
      }
    });
  }

  loginTabs.forEach((tab) => {
    tab.addEventListener("click", () => {
      const tabId = tab.getAttribute("data-tab");
      loginTabs.forEach((t) => t.classList.remove("active"));
      tab.classList.add("active");
      loginForms.forEach((form) => {
        form.classList.remove("active");
        if (form.id === `${tabId}Form`) {
          form.classList.add("active");
          form.querySelector('input:not([type="hidden"])')?.focus();
        }
      });
      resetFormErrors();
    });
  });

  // --- Gestione Invio Form con Fetch API ---
  document.getElementById("loginForm")?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const loginButton = e.target.querySelector('button[type="submit"]');
    const originalButtonText = loginButton.textContent; // Salva testo originale
    loginButton.disabled = true;
    loginButton.innerHTML = 'Accesso... <div class="spinner-mini-light"></div>';

    const emailInput = document.getElementById('login-email');
    const passwordInput = document.getElementById('login-password');
    emailInput.classList.remove('error-border');
    passwordInput.classList.remove('error-border');
    if(loginErrorMessage) loginErrorMessage.style.display = 'none';

    try {
      const response = await fetch("login.php", {
        method: "POST",
        body: new FormData(e.target),
      });

      if (!response.ok) {
        let errorData = { message: `Errore HTTP: ${response.status}` };
        try { errorData = await response.json(); } catch (e) { /* Ignora */ }
        throw new Error(errorData.message || `Errore HTTP: ${response.status}`);
      }
      const result = await response.json();

      if (result.success) {
        const userDataToStore = {
          nome: result.nome,
          email: result.email,
          iconPath: defaultUserIconPath
        };
        localStorage.setItem('userDataEFF', JSON.stringify(userDataToStore));
        closeLoginPopup();
        // REINDIRIZZAMENTO CORRETTO per dovesiamo.html
        window.location.href = result.is_admin ? "indexadmin.html" : "dovesiamoaccesso.html";
      } else {
        emailInput.classList.add('error-border');
        passwordInput.classList.add('error-border');
        if(loginErrorMessage) {
          loginErrorMessage.textContent = result.message || "Credenziali non valide.";
          loginErrorMessage.style.display = 'block';
        } else {
          alert(result.message || "Credenziali non valide.");
        }
      }
    } catch (error) {
      emailInput.classList.add('error-border');
      passwordInput.classList.add('error-border');
      if(loginErrorMessage) {
        loginErrorMessage.textContent = "Errore di connessione o risposta non valida dal server.";
        loginErrorMessage.style.display = 'block';
      } else {
        alert("Errore di connessione o risposta non valida dal server.");
      }
      console.error("Errore login:", error);
    } finally {
      loginButton.disabled = false;
      loginButton.innerHTML = originalButtonText; // Ripristina testo originale
    }
  });

  document.getElementById("registerForm")?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const registerButton = e.target.querySelector('button[type="submit"]');
    const originalButtonText = registerButton.textContent; // Salva testo originale
    registerButton.disabled = true;
    registerButton.innerHTML = 'Registrazione... <div class="spinner-mini-light"></div>';
    if(registerErrorMessage) registerErrorMessage.style.display = 'none';
    e.target.querySelectorAll('.form-control.error-border').forEach(input => input.classList.remove('error-border'));

    try {
      const response = await fetch("registrati.php", {
        method: "POST",
        body: new FormData(e.target),
      });

      if (!response.ok) {
        let errorMsg = `Errore HTTP: ${response.status} ${response.statusText}`;
        try { const errorData = await response.json(); errorMsg = errorData.message || errorMsg; }
        catch(err) { /* Ignora se non √® JSON */ }
        throw new Error(errorMsg);
      }
      const result = await response.json();

      if (result.success) {
        alert(result.message || "Registrazione completata con successo! Ora puoi effettuare il login.");
        const loginTabButton = document.querySelector('.login-tab[data-tab="login"]');
        if(loginTabButton) loginTabButton.click();

        const loginEmailInput = document.getElementById('login-email');
        const registerEmailInput = document.getElementById('register-email');
        if(loginEmailInput && registerEmailInput) {
          loginEmailInput.value = registerEmailInput.value;
        }
        e.target.reset();
      } else {
        if(registerErrorMessage) {
          registerErrorMessage.textContent = result.message || "Errore durante la registrazione.";
          registerErrorMessage.style.display = 'block';
        } else {
          alert("Errore Registrazione: " + (result.message || "Si √® verificato un errore."));
        }
        if (result.errors) {
          for (const fieldNameFromError in result.errors) {
            const inputElement = e.target.elements[fieldNameFromError] || document.getElementById(`register-${fieldNameFromError}`);
            if (inputElement) {
              inputElement.classList.add('error-border');
            }
          }
        }
      }
    } catch (error) {
      if(registerErrorMessage) {
        registerErrorMessage.textContent = "Errore: " + error.message;
        registerErrorMessage.style.display = 'block';
      } else {
        alert("Errore durante la registrazione: " + error.message);
      }
      console.error("Dettaglio errore registrazione:", error);
    } finally {
      registerButton.disabled = false;
      registerButton.innerHTML = originalButtonText; // Ripristina testo originale
    }
  });

  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape" && loginPopup && loginPopup.classList.contains("active")) { // Aggiunto controllo per loginPopup
      closeLoginPopup();
    }
  });

  document.addEventListener('DOMContentLoaded', function() { // Spostato l'aggiornamento dell'anno qui
    const currentYearEl = document.getElementById("currentYear"); // Seleziona per ID
    if (currentYearEl) { // Controlla se l'elemento esiste
      currentYearEl.textContent = new Date().getFullYear();
    }
  });
</script>

</body>
</html>