<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="images/logo.png" type="image/x-icon"> <title>Incontri sulla Parola - Eremo Frate Francesco</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<header class="navbar-container" id="navbarContainer">
    <nav class="navbar">
        <div class="logo">
            <a href="index.html">
                <span class="emoji">üèîÔ∏è</span>
                <h2>Eremo Frate Francesco</h2>
            </a>
        </div>
        <div class="menu">
            <a href="eventiincorso.html">Calendario attivit√†</a>
            <a href="eventipassati.html">Archivio attivit√†</a>
            <span class="separator">|</span>
            <a href="incontrisullaparola.html" class="active">Incontri sulla parola</a>
            <span class="separator">|</span>
            <a href="dovesiamo.html">Dove siamo</a>
            <a href="contatti.html">Contatti</a>
        </div>
        <div class="right-menu">
            <button id="login-btn" class="login-btn">Accedi</button>
            <button class="hamburger" onclick="toggleMobileMenu()" aria-label="Toggle menu">‚ò∞</button>
        </div>
    </nav>
    <div class="mobile-menu" id="mobileMenu">
        <a href="eventiincorso.html" onclick="closeMobileMenu()">Calendario attivit√†</a>
        <a href="eventipassati.html" onclick="closeMobileMenu()">Archivio attivit√†</a>
        <a href="incontrisullaparola.html" onclick="closeMobileMenu()">Incontri sulla parola</a>
        <a href="dovesiamo.html" onclick="closeMobileMenu()">Dove siamo</a>
        <a href="contatti.html" onclick="closeMobileMenu()">Contatti</a>
        <a href="#" id="login-btn-mobile" onclick="openLoginPopup(); closeMobileMenu();">Accedi</a>
    </div>
</header>

<main>
<section class="page-header section-padding" style="background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://picsum.photos/1920/1080?random=bible,study') center/cover; color: white; text-align: center; border-radius: 0 0 var(--border-radius-large) var(--border-radius-large); margin-bottom: 3rem;">
        <div class="container">
            <h1 style="color: white;">Incontri sulla Parola</h1>
            <p style="font-size: 1.2rem; opacity: 0.9;">Un cammino settimanale di scoperta e crescita spirituale attraverso la Lectio Divina.</p>
        </div>
    </section>
</div>
    <div class="container">
        <section class="chi-siamo-section section-padding">
            <div class="chi-siamo-image-container">
                <img src="https://picsum.photos/600/400?random=group,reading,discussion" alt="Gruppo di studio biblico" class="chi-siamo-image">
            </div>
            <div class="chi-siamo-content">
                <h2>Cosa sono gli Incontri sulla Parola?</h2>
                <p>Gli Incontri sulla Parola sono un appuntamento settimanale dedicato all'ascolto, alla meditazione e alla condivisione della Parola di Dio, secondo il metodo della <strong>Lectio Divina</strong>. √à un'opportunit√† per nutrire la propria fede, approfondire la comprensione delle Scritture e crescere insieme come comunit√†.</p>
                <p>Non si tratta di uno studio accademico, ma di un'esperienza spirituale che cerca di far risuonare la Parola nella vita di ciascuno, in un clima di ascolto reciproco e di preghiera.</p>
            </div>
        </section>

        <section class="section-padding" style="background-color: var(--light); border-radius: var(--border-radius-large);">
            <h2 class="text-center mb-4" style="color: var(--secondary);">Informazioni Pratiche</h2>
            <div class="card-grid">
                <div class="card info-card">
                    <div class="card-content">
                        <h3><i class="fas fa-calendar-alt" style="margin-right: 8px; color: var(--secondary);"></i> Quando</h3>
                        <p>Ogni Mercoled√¨ sera<br>Orario: 20:30 - 22:00</p>
                        <p><strong>Prossimo incontro: <span id="next-meeting-date">[Data prossimo mercoled√¨]</span></strong></p>
                    </div>
                </div>

                <div class="card info-card">
                    <div class="card-content">
                        <h3><i class="fas fa-map-marker-alt" style="margin-right: 8px; color: var(--secondary);"></i> Dove</h3>
                        <p>Presso la sala incontri dell'Eremo Frate Francesco<br>Via San Vito, Nembro (BG)</p>
                        <a href="dovesiamo.html" class="card-btn card-btn-secondary" style="margin-top: 1rem;">Come raggiungerci</a>
                    </div>
                </div>

                <div class="card info-card">
                    <div class="card-content">
                        <h3><i class="fas fa-users" style="margin-right: 8px; color: var(--secondary);"></i> A chi √® rivolto</h3>
                        <p>L'invito √® aperto a tutti: giovani, adulti, famiglie. Non √® richiesta alcuna preparazione teologica specifica, solo il desiderio di mettersi in ascolto della Parola.</p>
                    </div>
                </div>
            </div>
        </section>


        <section class="chi-siamo-section reverse section-padding">
            <div class="chi-siamo-image-container">
                <img src="https://picsum.photos/600/400?random=community,prayer,circle" alt="Condivisione comunitaria" class="chi-siamo-image">
            </div>
            <div class="chi-siamo-content">
                <h2>Un Approccio Comunitario alla Lectio Divina</h2>
                <p>La Lectio Divina √® un metodo antico di preghiera e lettura della Bibbia che si articola in quattro momenti: <strong>Lectio</strong> (lettura), <strong>Meditatio</strong> (meditazione), <strong>Oratio</strong> (preghiera) e <strong>Contemplatio</strong> (contemplazione).</p>
                <p>Durante i nostri incontri, applichiamo questo metodo in modo comunitario. Dopo la lettura attenta di un brano biblico, ognuno √® invitato a meditare su ci√≤ che lo ha colpito, a trasformarlo in preghiera personale e, infine, a condividere liberamente (senza obbligo) le proprie riflessioni con il gruppo, arricchendosi reciprocamente.</p>
            </div>
        </section>

        <section class="section-padding">
            <h2 class="text-center mb-4">I Passi della Lectio Comunitaria</h2>
            <div class="card-grid">
                <div class="card">
                    <div class="card-content text-center">
                        <div style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;">1</div>
                        <h3>Lectio (Lettura)</h3>
                        <p>Lettura attenta e ripetuta del brano biblico scelto per l'incontro, cercando di cogliere il messaggio letterale.</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-content text-center">
                        <div style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;">2</div>
                        <h3>Meditatio (Meditazione)</h3>
                        <p>Riflessione personale: cosa dice a me, oggi, questa Parola? Quali sentimenti o pensieri suscita?</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-content text-center">
                        <div style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;">3</div>
                        <h3>Oratio (Preghiera)</h3>
                        <p>Risposta personale alla Parola attraverso la preghiera: lode, ringraziamento, richiesta, supplica.</p>
                    </div>
                </div>
            </div>
        </section>

    </div> </main>

<div class="login-popup-overlay" id="loginOverlay"></div>
<div class="login-popup" id="loginPopup">
    <button class="close-popup" id="closePopup" aria-label="Chiudi popup">&times;</button>
    <div class="login-tabs">
        <div class="login-tab active" data-tab="login">Accedi</div>
        <div class="login-tab" data-tab="register">Registrati</div>
    </div>
    <form class="login-form active" id="loginForm" method="POST"> <div class="form-group mb-3">
        <label for="login-email">Email</label>
        <input type="email" id="login-email" name="login-email" class="form-control" required autocomplete="email"> </div>
        <div class="form-group mb-3">
            <label for="login-password">Password</label>
            <input type="password" id="login-password" name="login-password" class="form-control" required autocomplete="current-password"> </div>
        <div class="form-actions">
            <button type="submit" class="btn-popup">Accedi</button>
        </div>
    </form>
    <form class="login-form" id="registerForm" method="POST">
        <div class="form-group mb-3">
            <label for="register-name">Nome</label>
            <input type="text" id="register-name" name="register-name" class="form-control" required autocomplete="given-name"> </div>
        <div class="form-group mb-3">
            <label for="register-surname">Cognome</label>
            <input type="text" id="register-surname" name="register-surname" class="form-control" required autocomplete="family-name"> </div>
        <div class="form-group mb-3">
            <label for="register-email">Email</label>
            <input type="email" id="register-email" name="register-email" class="form-control" required autocomplete="email"> </div>
        <div class="form-group mb-3">
            <label for="register-password">Password</label>
            <input type="password" id="register-password" name="register-password" class="form-control" required minlength="8" autocomplete="new-password"> <small>Minimo 8 caratteri.</small>
        </div>
        <div class="terms-checkbox mb-3">
            <input type="checkbox" id="register-terms" name="register-terms" required> <label for="register-terms">Accetto i <a href="/termini" target="_blank">termini e condizioni</a></label>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn-popup">Registrati</button>
        </div>
    </form>
</div>

<footer>
  <p>¬© <span id="currentYear"></span> Eremo Frate Francesco. Tutti i diritti riservati. Via della Spiritualit√† 123, Nembro (BG) - Italia</p>
</footer>

<script>
    // --- Navbar Scroll Logic ---
    let lastScroll = 0;
    const navbarContainer = document.getElementById('navbarContainer');
    window.addEventListener('scroll', function() {
        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
        if (currentScroll <= 50) { // Buffer aggiunto
            navbarContainer.classList.remove('hidden');
            lastScroll = 0;
            return;
        }
        if (currentScroll > lastScroll && !navbarContainer.classList.contains('hidden')) {
            // Scroll Down
            navbarContainer.classList.add('hidden');
        } else if (currentScroll < lastScroll && navbarContainer.classList.contains('hidden')) {
            // Scroll Up
            navbarContainer.classList.remove('hidden');
        }
        lastScroll = currentScroll;
    }, false);

    // --- Mobile Menu Logic ---
    const mobileMenu = document.getElementById("mobileMenu");
    const hamburger = document.querySelector(".hamburger");
    function toggleMobileMenu() {
        const isOpen = mobileMenu.classList.toggle("open");
        hamburger.setAttribute("aria-expanded", isOpen);
        document.body.style.overflow = isOpen ? 'hidden' : ''; // Blocca/sblocca scroll
    }
    function closeMobileMenu() {
        mobileMenu.classList.remove("open");
        hamburger.setAttribute("aria-expanded", "false");
        document.body.style.overflow = '';
    }
    // Chiudi menu cliccando fuori
    document.addEventListener('click', function(event) {
        if (mobileMenu.classList.contains('open') &&
            !mobileMenu.contains(event.target) &&
            !hamburger.contains(event.target)) {
            closeMobileMenu();
        }
    });

    // --- Login Popup Logic ---
    const loginBtn = document.getElementById('login-btn');
    const loginBtnMobile = document.getElementById('login-btn-mobile');
    const loginOverlay = document.getElementById('loginOverlay');
    const loginPopup = document.getElementById('loginPopup');
    const closePopupBtn = document.getElementById('closePopup');
    const loginTabs = document.querySelectorAll('.login-tab');
    const loginForms = document.querySelectorAll('.login-form');

    function openLoginPopup() {
        loginOverlay.classList.add('active');
        loginPopup.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function closeLoginPopup() {
        loginOverlay.classList.remove('active');
        loginPopup.classList.remove('active');
        document.body.style.overflow = '';
    }

    if (loginBtn) {
        loginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            openLoginPopup();
        });
    }
    if (loginBtnMobile) {
        loginBtnMobile.addEventListener('click', (e) => {
            e.preventDefault();
            closeMobileMenu();
            openLoginPopup();
        });
    }

    if(closePopupBtn) { closePopupBtn.addEventListener('click', closeLoginPopup); }
    if(loginOverlay) { loginOverlay.addEventListener('click', closeLoginPopup); }

    // Login Tabs Switch
    loginTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const tabId = tab.getAttribute('data-tab');
            loginTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            loginForms.forEach(form => {
                form.classList.remove('active');
                if (form.id === `${tabId}Form`) {
                    form.classList.add('active');
                }
            });
        });
    });

    // --- Gestione Invio Form con Fetch API ---

    // LOGIN
    document.getElementById('loginForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const loginButton = e.target.querySelector('button[type="submit"]');
        const originalButtonText = loginButton.innerHTML;
        loginButton.disabled = true;
        loginButton.innerHTML = 'Accesso...'; // Feedback visivo

        try {
            const response = await fetch('login.php', { // Assicurati che il percorso 'login.php' sia corretto
                method: 'POST',
                // Non serve 'Content-Type' header quando si usa FormData con fetch
                body: new FormData(e.target) // Invia i dati del form
            });

            // Controlla se la risposta √® OK (status 200-299)
            if (!response.ok) {
                // Prova a leggere l'errore dal corpo se possibile, altrimenti usa statusText
                let errorMsg = `Errore HTTP: ${response.status} ${response.statusText}`;
                try {
                    const errorData = await response.json();
                    errorMsg = errorData.message || errorMsg;
                } catch(e) { /* Ignora se il corpo non √® JSON */ }
                throw new Error(errorMsg);
            }

            const result = await response.json(); // Aspetta risposta JSON

            if (result.success) {
                // alert(result.message); // Puoi mostrare un messaggio meno invasivo
                closeLoginPopup();
                // Reindirizzamento differenziato
                if (result.is_admin) {
                    window.location.href = 'indexadmin.html'; // Pagina admin
                } else {
                    window.location.href = 'indexaccesso.html'; // Pagina utente loggato
                }
            } else {
                // Mostra errore specifico dal backend
                alert("Errore Login: " + (result.message || "Credenziali non valide."));
            }
        } catch (error) {
            // Errore di rete o nella fetch o nel parsing JSON
            alert("Errore durante il login: " + error.message);
            console.error("Dettaglio errore login:", error);
        } finally {
            // Riabilita il bottone indipendentemente dal risultato
            loginButton.disabled = false;
            loginButton.innerHTML = originalButtonText;
        }
    });

    // REGISTRAZIONE
    document.getElementById('registerForm')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const registerButton = e.target.querySelector('button[type="submit"]');
        const originalButtonText = registerButton.innerHTML;
        registerButton.disabled = true;
        registerButton.innerHTML = 'Registrazione...'; // Feedback visivo

        try {
            const response = await fetch('registrati.php', { // Assicurati che 'registrati.php' sia corretto
                method: 'POST',
                body: new FormData(e.target)
            });

            if (!response.ok) {
                let errorMsg = `Errore HTTP: ${response.status} ${response.statusText}`;
                try {
                    const errorData = await response.json();
                    errorMsg = errorData.message || errorMsg;
                } catch(e) { /* Ignora se il corpo non √® JSON */ }
                throw new Error(errorMsg);
            }

            const result = await response.json();

            if (result.success) {
                alert(result.message || "Registrazione completata con successo!");
                closeLoginPopup();
                // Potresti voler effettuare il login automatico qui o reindirizzare alla pagina di login
                // openLoginPopup(); // Riapri per login?
                // document.querySelector('.login-tab[data-tab="login"]').click(); // Seleziona tab login
            } else {
                alert("Errore Registrazione: " + (result.message || "Si √® verificato un errore."));
            }
        } catch (error) {
            alert("Errore durante la registrazione: " + error.message);
            console.error("Dettaglio errore registrazione:", error);
        } finally {
            registerButton.disabled = false;
            registerButton.innerHTML = originalButtonText;
        }
    });

    // Chiudi popup con tasto Esc
    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && loginPopup.classList.contains('active')) {
            closeLoginPopup();
        }
    });


    // Calcola e formatta la data del prossimo mercoled√¨
    function getNextWednesday() {
        const today = new Date();
        const currentDay = today.getDay(); // 0 = Domenica, 1 = Luned√¨, ..., 3 = Mercoled√¨, ... 6 = Sabato
        var daysUntilWednesday = (3 - currentDay + 7) % 7; // Giorni mancanti al prossimo mercoled√¨
        // Se oggi √® mercoled√¨ e l'ora attuale √® dopo l'orario dell'incontro (es. 22:00), calcola il mercoled√¨ successivo
        if (daysUntilWednesday === 0 && today.getHours() >= 22) {
            daysUntilWednesday = 7;
        }
        const nextWednesday = new Date(today);
        nextWednesday.setDate(today.getDate() + daysUntilWednesday);
        return nextWednesday;
    }

    function formatDateItalian(date) {
        const options = { weekday: 'long', day: 'numeric', month: 'long' };
        return date.toLocaleDateString('it-IT', options);
    }

    // Aggiorna la data nel DOM quando il documento √® pronto
    document.addEventListener('DOMContentLoaded', function() {
        const nextMeetingDateElement = document.getElementById('next-meeting-date');
        if (nextMeetingDateElement) {
            nextMeetingDateElement.textContent = formatDateItalian(getNextWednesday());
        }

        // Opzionale: Aggiungi animazioni semplici allo scroll (se desiderato)
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = 1;
                    entry.target.style.transform = 'translateY(0)';
                    // entry.target.classList.add('visible'); // O aggiungi una classe
                }
            });
        }, { threshold: 0.1 }); // Attiva quando il 10% √® visibile

        document.querySelectorAll('.chi-siamo-section, .card').forEach(el => {
            el.style.opacity = 0; // Imposta opacit√† iniziale
            el.style.transform = 'translateY(20px)'; // Sposta leggermente in basso
            el.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
            observer.observe(el);
        });
    });

    const currentYearSpan = document.querySelector("footer p span");
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }

</script>

</body>
</html>