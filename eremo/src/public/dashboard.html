<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="images/logo.png" type="image/x-icon">
    <title>Admin Dashboard - Eremo Frate Francesco</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Dashboard Specific Styles */
        :root {
            --dash-primary: #365e51;
            --dash-secondary: #8db187;
            --dash-accent: #d18c60;
            --dash-light: #f8f5ef;
            --dash-dark: #1e3b2f;
            --dash-white: #ffffff;
            --dash-gray-light: #e9e9e9;
            --dash-danger: #e74c3c;
            --dash-warning: #f39c12;
            --dash-info: #3498db;
            --dash-success: #2ecc71;
        }

        .dashboard-main {
            padding: 2rem;
        }

        .dashboard-main h1 {
            color: var(--dash-primary);
            margin-bottom: 2rem;
            text-align: left;
        }

        .dashboard-section {
            background-color: var(--dash-white);
            padding: 1.5rem;
            border-radius: var(--border-radius-medium);
            box-shadow: var(--shadow-light);
            margin-bottom: 2rem;
        }

        .dashboard-section h2 {
            color: var(--dash-secondary);
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--dash-gray-light);
            padding-bottom: 0.8rem;
            font-size: 1.6rem;
            text-align: left;
        }
        .dashboard-section h2 i {
            margin-right: 0.5rem;
        }

        .event-list-admin .event-item-admin {
            border: 1px solid var(--dash-gray-light);
            border-radius: var(--border-radius-medium);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .event-header-admin {
            background-color: var(--dash-light);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-bottom: 1px solid var(--dash-gray-light);
        }
        .event-header-admin:hover {
            background-color: #eef3ec;
        }

        .event-header-admin h3 {
            margin: 0;
            color: var(--dash-primary);
            font-size: 1.3rem;
        }
        .event-header-admin .event-date-admin {
            font-size: 0.9rem;
            color: var(--dash-dark);
        }

        .event-details-admin {
            padding: 1.5rem;
            display: none; /* Hidden by default, shown on click */
        }
        .event-details-admin.active {
            display: block;
            animation: fadeIn 0.5s;
        }


        .participants-list {
            list-style: none;
            padding: 0;
        }
        .participants-list li {
            padding: 0.8rem;
            border-bottom: 1px solid var(--dash-gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .participants-list li:last-child {
            border-bottom: none;
        }
        .participants-list .participant-info {
            font-size: 0.95rem;
        }
        .participants-list .participant-contact {
            font-size: 0.85rem;
            color: var(--gray-dark);
        }

        .btn-admin {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-medium);
            border: none;
            text-align: center;
            margin-left: 0.5rem;
        }
        .btn-admin-danger { background-color: var(--dash-danger); color: white; }
        .btn-admin-danger:hover { background-color: #c0392b; }
        .btn-admin-secondary { background-color: var(--dash-secondary); color: white; }
        .btn-admin-secondary:hover { background-color: var(--dash-primary); }
        .btn-admin-warning { background-color: var(--dash-warning); color: white; }
        .btn-admin-warning:hover { background-color: #e67e22; }
        .btn-admin-info { background-color: var(--dash-info); color: white; }
        .btn-admin-info:hover { background-color: #2980b9; }


        .media-upload-form, .comments-management {
            margin-top: 1rem;
        }
        .media-upload-form input[type="file"] {
            display: block;
            margin-bottom: 1rem;
        }

        /* Table for participants for better layout */
        .participants-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .participants-table th, .participants-table td {
            text-align: left;
            padding: 0.8rem;
            border-bottom: 1px solid var(--dash-gray-light);
            font-size: 0.9rem;
        }
        .participants-table th {
            background-color: var(--dash-light);
            color: var(--dash-primary);
            font-weight: 600;
        }
        .participants-table td .btn-admin {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: var(--border-radius-medium);
            position: relative;
        }
        .close-modal-btn {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal-btn:hover, .close-modal-btn:focus {
            color: black;
            text-decoration: none;
        }
        .modal-content h3 {
            margin-top: 0;
            color: var(--dash-primary);
        }
        .modal-content .form-group { margin-bottom: 1rem; }
        .modal-content .form-group label { display: block; margin-bottom: .5rem; font-weight: 500; color: var(--dash-dark); }
        .modal-content .form-group input[type="file"], .modal-content .form-group textarea {
            width: 100%;
            padding: .7rem;
            border: 1px solid var(--dash-gray-medium);
            border-radius: 5px;
        }
        .dashboard-quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .stat-card {
            background-color: var(--dash-white);
            padding: 1.5rem;
            border-radius: var(--border-radius-medium);
            box-shadow: var(--shadow-light);
            text-align: center;
        }
        .stat-card i {
            font-size: 2.5rem;
            color: var(--dash-secondary);
            margin-bottom: 1rem;
            display: block;
        }
        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dash-primary);
            margin-bottom: 0.5rem;
        }
        .stat-card .stat-label {
            font-size: 1rem;
            color: var(--gray-dark);
        }

    </style>
</head>
<body class="page-dashboard">

<header class="navbar-container" id="navbarContainer">
    <nav class="navbar">
        <div class="logo">
            <a href="indexadmin.html">
                <span class="emoji">üèîÔ∏è</span>
                <h2>Eremo Frate Francesco - Admin</h2>
            </a>
        </div>
        <div class="right-menu">
            <div class="user-dropdown" id="userDropdownContainer">
                <button class="user-btn" onclick="toggleUserMenu()" aria-haspopup="true" aria-expanded="false">
                    <span class="user-avatar" id="navbar-avatar">üë§</span> <span class="user-name" id="navbar-username">Admin</span> <span class="dropdown-arrow">‚ñº</span>
                </button>
                <div class="dropdown-menu" aria-labelledby="userDropdownContainer">
                    <a href="dashboard.html">Dashboard</a>
                    <a href="areapersonale.html">Il mio profilo</a>
                    <a href="eventiincorsoAdmin.html">Gestione Eventi</a>
                    <a href="#" onclick="logout()">Esci</a>
                </div>
            </div>
            <button class="hamburger" onclick="toggleMobileMenu()" aria-label="Toggle menu">‚ò∞</button>
        </div>
    </nav>
    <div class="mobile-menu" id="mobileMenu">
        <a href="dashboard.html" onclick="closeMobileMenu()">Dashboard</a>
        <a href="areapersonale.html" onclick="closeMobileMenu()">Il mio profilo</a>
        <a href="eventiincorsoAdmin.html" onclick="closeMobileMenu()">Gestione Eventi</a>
        <a href="#" onclick="logout(); closeMobileMenu();">Esci</a>
    </div>
</header>

<main class="dashboard-main">
    <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>

    <section class="dashboard-quick-stats">
        <div class="stat-card">
            <i class="fas fa-calendar-alt"></i>
            <div id="total-events" class="stat-value">0</div>
            <div class="stat-label">Eventi Totali</div>
        </div>
        <div class="stat-card">
            <i class="fas fa-users"></i>
            <div id="total-bookings" class="stat-value">0</div>
            <div class="stat-label">Prenotazioni Totali</div>
        </div>
        <div class="stat-card">
            <i class="fas fa-user-check"></i>
            <div id="total-participants" class="stat-value">0</div>
            <div class="stat-label">Partecipanti Totali</div>
        </div>
        <div class="stat-card">
            <i class="fas fa-comments"></i>
            <div id="total-comments" class="stat-value">0</div>
            <div class="stat-label">Commenti Totali</div>
        </div>
    </section>

    <section class="dashboard-section" id="eventManagementSection">
        <h2><i class="fas fa-calendar-check"></i> Gestione Eventi e Partecipanti</h2>
        <div class="event-list-admin" id="adminEventList">
            <p>Caricamento eventi...</p>
        </div>
    </section>

</main>

<div id="uploadMediaModal" class="modal">
    <div class="modal-content">
        <span class="close-modal-btn" onclick="closeModal('uploadMediaModal')">&times;</span>
        <h3>Carica Media per Evento: <span id="uploadMediaEventTitle"></span></h3>
        <form id="uploadMediaForm" class="media-upload-form">
            <input type="hidden" id="uploadMediaEventId" name="eventId">
            <div class="form-group">
                <label for="mediaFiles">Seleziona Immagini/Video:</label>
                <input type="file" id="mediaFiles" name="mediaFiles[]" multiple accept="image/*,video/*">
            </div>
            <div class="form-group">
                <label for="mediaDescription">Descrizione (opzionale):</label>
                <textarea id="mediaDescription" name="description" rows="3"></textarea>
            </div>
            <button type="submit" class="btn-admin btn-admin-secondary"><i class="fas fa-upload"></i> Carica Media</button>
        </form>
        <div id="uploadMediaFeedback"></div>
    </div>
</div>

<div id="manageCommentsModal" class="modal">
    <div class="modal-content">
        <span class="close-modal-btn" onclick="closeModal('manageCommentsModal')">&times;</span>
        <h3>Gestisci Commenti per Evento: <span id="commentsEventTitle"></span></h3>
        <div id="commentsListContainer">
            <p>Caricamento commenti...</p>
        </div>
        <div id="commentsManagementFeedback"></div>
    </div>
</div>


<footer>
    <p>¬© <span id="currentYear"></span> Eremo Frate Francesco. Operazioni Admin.</p>
</footer>

<script>
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    // --- Navbar & Mobile Menu Logic (semplificato, assicurati di usare quello completo se lo hai gi√†) ---
    const navbarContainer = document.getElementById('navbarContainer');
    let lastScroll = 0;
    window.addEventListener('scroll', function() {
        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
        if (currentScroll <= 0) { navbarContainer.classList.remove('hidden'); return; }
        if (currentScroll > lastScroll && !navbarContainer.classList.contains('hidden')) {
            navbarContainer.classList.add('hidden');
        } else if (currentScroll < lastScroll && navbarContainer.classList.contains('hidden')) {
            navbarContainer.classList.remove('hidden');
        }
        lastScroll = currentScroll <= 0 ? 0 : currentScroll;
    });

    function toggleMobileMenu() {
        const mobileMenu = document.getElementById("mobileMenu");
        mobileMenu.classList.toggle("open");
    }
    function closeMobileMenu() {
        const mobileMenu = document.getElementById("mobileMenu");
        mobileMenu.classList.remove("open");
    }
    function toggleUserMenu() {
        const dropdown = document.querySelector('.user-dropdown');
        dropdown.classList.toggle('show');
        dropdown.querySelector('.user-btn').setAttribute('aria-expanded', dropdown.classList.contains('show'));
    }
    document.addEventListener('click', function(event) {
        const dropdown = document.querySelector('.user-dropdown');
        if (dropdown && !dropdown.contains(event.target) && dropdown.classList.contains('show')) {
            dropdown.classList.remove('show');
            dropdown.querySelector('.user-btn').setAttribute('aria-expanded', 'false');
        }
    });

    function logout() {
        // Implementa la logica di logout (es. chiamata a script PHP, pulizia sessione/localStorage)
        alert('Logout effettuato (simulato).');
        window.location.href = 'index.html'; // O pagina di login
    }

    // --- Dashboard Logic ---
    const adminEventList = document.getElementById('adminEventList');
    const uploadMediaModal = document.getElementById('uploadMediaModal');
    const manageCommentsModal = document.getElementById('manageCommentsModal');

    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) modal.style.display = 'block';
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) modal.style.display = 'none';
        // Pulisci feedback e form se necessario
        if (modalId === 'uploadMediaModal') {
            document.getElementById('uploadMediaFeedback').innerHTML = '';
            document.getElementById('uploadMediaForm').reset();
        }
        if (modalId === 'manageCommentsModal') {
            document.getElementById('commentsManagementFeedback').innerHTML = '';
        }
    }

    // Chiudi modal cliccando fuori
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            closeModal(event.target.id);
        }
    }

    async function fetchAdminEventData() {
        try {
            // Sostituisci con il vero endpoint e aggiungi autenticazione/token se necessario
            const response = await fetch('get_event_details_admin.php'); // PHP script da creare
            if (!response.ok) throw new Error(`Errore HTTP: ${response.status}`);
            const data = await response.json();

            if (data.success && data.events) {
                renderAdminEvents(data.events);
                updateQuickStats(data.stats || {}); // stats dovrebbe contenere totalEvents, totalBookings, etc.
            } else {
                adminEventList.innerHTML = `<p>Errore nel caricamento dati: ${data.message || 'Nessun evento trovato.'}</p>`;
            }
        } catch (error) {
            console.error('Errore fetchAdminEventData:', error);
            adminEventList.innerHTML = `<p>Impossibile caricare gli eventi. ${error.message}</p>`;
        }
    }

    function updateQuickStats(stats) {
        document.getElementById('total-events').textContent = stats.totalEvents || 0;
        document.getElementById('total-bookings').textContent = stats.totalBookings || 0;
        document.getElementById('total-participants').textContent = stats.totalParticipants || 0;
        document.getElementById('total-comments').textContent = stats.totalComments || 0;
    }


    function renderAdminEvents(events) {
        if (!adminEventList) return;
        if (events.length === 0) {
            adminEventList.innerHTML = '<p>Nessun evento da gestire al momento.</p>';
            return;
        }
        adminEventList.innerHTML = ''; // Pulisci

        events.forEach(event => {
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item-admin';
            eventItem.innerHTML = `
                <div class="event-header-admin">
                    <div>
                        <h3>${event.titolo}</h3>
                        <span class="event-date-admin">Data: ${formatDbDate(event.data)} ${event.orario || ''}</span>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="event-details-admin">
                    <h4>Partecipanti (${event.participants ? event.participants.length : 0} / ${event.posti_disponibili_totali || event.posti_disponibili})</h4>
                    ${renderParticipantsTable(event.participants || [], event.id_evento)}

                    <h4>Azioni Evento</h4>
                    <button class="btn-admin btn-admin-secondary" onclick="downloadParticipantList(${event.id_evento}, '${event.titolo}')">
                        <i class="fas fa-file-pdf"></i> PDF Partecipanti
                    </button>
                    <button class="btn-admin btn-admin-warning" onclick="openUploadMediaModal(${event.id_evento}, '${event.titolo}')" ${new Date(event.data) > new Date() ? 'disabled title="Media caricabile solo per eventi passati"' : ''}>
                        <i class="fas fa-photo-video"></i> Gestisci Media
                    </button>
                    <button class="btn-admin btn-admin-info" onclick="openManageCommentsModal(${event.id_evento}, '${event.titolo}')">
                        <i class="fas fa-comments"></i> Gestisci Commenti
                    </button>
                    <button class="btn-admin btn-admin-danger" onclick="confirmDeleteEvent(${event.id_evento}, '${event.titolo}')">
                        <i class="fas fa-trash-alt"></i> Elimina Evento
                    </button>
                </div>
            `;
            adminEventList.appendChild(eventItem);

            const header = eventItem.querySelector('.event-header-admin');
            const details = eventItem.querySelector('.event-details-admin');
            header.addEventListener('click', () => {
                details.classList.toggle('active');
                header.querySelector('i').classList.toggle('fa-chevron-down');
                header.querySelector('i').classList.toggle('fa-chevron-up');
            });
        });
    }

    function formatDbDate(dateString) {
        if (!dateString) return 'N/D';
        const date = new Date(dateString);
        return date.toLocaleDateString('it-IT', { day: '2-digit', month: '2-digit', year: 'numeric' });
    }

    function renderParticipantsTable(participants, eventId) {
        if (participants.length === 0) {
            return '<p>Nessun partecipante iscritto.</p>';
        }
        let tableHtml = `
            <table class="participants-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Cognome</th>
                        <th>Contatto Prenotazione</th>
                        <th>Azione</th>
                    </tr>
                </thead>
                <tbody>`;
        participants.forEach(p => {
            tableHtml += `
                <tr>
                    <td>${p.nome || 'N/D'}</td>
                    <td>${p.cognome || 'N/D'}</td>
                    <td>${p.contatto_prenotazione || 'N/D'}</td>
                    <td>
                        <button class="btn-admin btn-admin-danger btn-sm" onclick="removeParticipant(${eventId}, ${p.id_partecipante}, '${p.nome} ${p.cognome}')">
                            <i class="fas fa-user-minus"></i> Rimuovi
                        </button>
                    </td>
                </tr>`;
        });
        tableHtml += '</tbody></table>';
        return tableHtml;
    }

    async function removeParticipant(eventId, participantId, participantName) {
        if (!confirm(`Sei sicuro di voler rimuovere ${participantName} dall'evento?`)) return;

        try {
            const formData = new FormData();
            formData.append('action', 'remove_participant');
            formData.append('event_id', eventId);
            formData.append('participant_id', participantId);

            // Sostituisci con il vero endpoint e aggiungi autenticazione/token
            const response = await fetch('manage_participants.php', { // PHP script da creare
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            alert(result.message);
            if (result.success) {
                fetchAdminEventData(); // Ricarica i dati
            }
        } catch (error) {
            console.error('Errore removeParticipant:', error);
            alert(`Errore durante la rimozione. ${error.message}`);
        }
    }

    async function downloadParticipantList(eventId, eventTitle) {
        // Questa funzione dovrebbe fare una richiesta a un endpoint PHP che genera il PDF.
        // Il PHP userebbe una libreria come FPDF o TCPDF.
        // Il browser poi scaricherebbe il file.
        alert(`Download PDF per "${eventTitle}" (ID: ${eventId}) - Implementare generazione PDF server-side.`);
        window.open(`generate_event_pdf.php?event_id=${eventId}`, '_blank');
    }

    function openUploadMediaModal(eventId, eventTitle) {
        document.getElementById('uploadMediaEventId').value = eventId;
        document.getElementById('uploadMediaEventTitle').textContent = eventTitle;
        // Qui potresti anche caricare la lista dei media gi√† presenti per questo evento
        openModal('uploadMediaModal');
    }

    document.getElementById('uploadMediaForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const eventId = document.getElementById('uploadMediaEventId').value;
        const files = document.getElementById('mediaFiles').files;
        const description = document.getElementById('mediaDescription').value;
        const feedbackDiv = document.getElementById('uploadMediaFeedback');

        if (files.length === 0) {
            feedbackDiv.innerHTML = '<p style="color: red;">Seleziona almeno un file.</p>';
            return;
        }
        feedbackDiv.innerHTML = '<p>Caricamento in corso...</p>';

        const formData = new FormData();
        formData.append('action', 'upload_media');
        formData.append('event_id', eventId);
        formData.append('description', description);
        for (let i = 0; i < files.length; i++) {
            formData.append('mediaFiles[]', files[i]);
        }

        try {
            // Sostituisci con il vero endpoint
            const response = await fetch('manage_event_media.php', { // PHP script da creare
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            if (result.success) {
                feedbackDiv.innerHTML = `<p style="color: green;">${result.message}</p>`;
                // Potresti voler ricaricare la lista dei media o chiudere il modal dopo un po'
                setTimeout(() => closeModal('uploadMediaModal'), 2000);
            } else {
                feedbackDiv.innerHTML = `<p style="color: red;">Errore: ${result.message}</p>`;
            }
        } catch (error) {
            console.error('Errore uploadMedia:', error);
            feedbackDiv.innerHTML = `<p style="color: red;">Errore durante l'upload. ${error.message}</p>`;
        }
    });


    async function openManageCommentsModal(eventId, eventTitle) {
        document.getElementById('commentsEventTitle').textContent = eventTitle;
        const container = document.getElementById('commentsListContainer');
        container.innerHTML = '<p>Caricamento commenti...</p>';
        openModal('manageCommentsModal');

        try {
            const response = await fetch(`manage_comments_admin.php?action=get_comments&event_id=${eventId}`);
            const result = await response.json();
            if (result.success && result.comments) {
                renderCommentsForAdmin(result.comments, eventId);
            } else {
                container.innerHTML = `<p>Errore nel caricamento dei commenti: ${result.message || 'Nessun commento.'}</p>`;
            }
        } catch (error) {
            console.error('Errore fetchComments:', error);
            container.innerHTML = `<p>Impossibile caricare i commenti. ${error.message}</p>`;
        }
    }

    function renderCommentsForAdmin(comments, eventId) {
        const container = document.getElementById('commentsListContainer');
        if (comments.length === 0) {
            container.innerHTML = '<p>Nessun commento per questo evento.</p>';
            return;
        }
        let html = '<ul class="participants-list">'; // Usiamo la stessa classe per coerenza, ma potremmo farne una ad hoc
        comments.forEach(comment => {
            html += `
                <li>
                    <div>
                        <strong>${comment.utente_nome || 'Anonimo'}</strong> (${comment.data_creazione})<br>
                        <small style="font-style: italic;">"${comment.testo}"</small>
                    </div>
                    <button class="btn-admin btn-admin-danger btn-sm" onclick="deleteComment(${comment.id_commento}, ${eventId})">
                        <i class="fas fa-trash-alt"></i> Elimina
                    </button>
                </li>`;
        });
        html += '</ul>';
        container.innerHTML = html;
    }

    async function deleteComment(commentId, eventIdForReload) {
        if (!confirm('Sei sicuro di voler eliminare questo commento?')) return;
        const feedbackDiv = document.getElementById('commentsManagementFeedback');
        feedbackDiv.innerHTML = '';

        try {
            const formData = new FormData();
            formData.append('action', 'delete_comment');
            formData.append('comment_id', commentId);

            const response = await fetch('manage_comments_admin.php', { // PHP script da creare/adattare
                method: 'POST',
                body: formData
            });
            const result = await response.json();

            if (result.success) {
                feedbackDiv.innerHTML = `<p style="color: green;">${result.message}</p>`;
                // Ricarica i commenti per quell'evento nel modal
                const eventTitle = document.getElementById('commentsEventTitle').textContent;
                openManageCommentsModal(eventIdForReload, eventTitle); // Riapre il modal forzando il reload
            } else {
                feedbackDiv.innerHTML = `<p style="color: red;">Errore: ${result.message}</p>`;
            }
        } catch (error) {
            console.error('Errore deleteComment:', error);
            feedbackDiv.innerHTML = `<p style="color: red;">Errore durante l'eliminazione. ${error.message}</p>`;
        }
    }

    async function confirmDeleteEvent(eventId, eventTitle) {
        if (!confirm(`Sei sicuro di voler eliminare l'evento "${eventTitle}"? Questa azione √® irreversibile e canceller√† anche tutte le prenotazioni e i media associati.`)) return;

        try {
            const formData = new FormData();
            formData.append('action', 'delete_event'); // Assicurati che gestione_eventi.php gestisca questa action
            formData.append('event_id', eventId);

            const response = await fetch('gestione_eventi.php', {
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            alert(result.message);
            if (result.success) {
                fetchAdminEventData(); // Ricarica gli eventi
            }
        } catch (error) {
            console.error('Errore deleteEvent:', error);
            alert(`Errore durante l'eliminazione dell'evento. ${error.message}`);
        }
    }


    // Inizializzazione al caricamento della pagina
    document.addEventListener('DOMContentLoaded', () => {
        fetchAdminEventData();
    });
</script>
</body>
</html>