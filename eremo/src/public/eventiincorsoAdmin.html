<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="images/logo.png" type="image/x-icon">
  <title>Calendario Attivit√† - Eremo Frate Francesco</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Stili aggiuntivi se necessari per il dropdown utente */
    .user-dropdown {
      position: relative;
      display: inline-block;
    }

    .user-dropdown .user-btn {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .user-dropdown .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
      top: 110%; /* Posiziona sotto il bottone */
      background-color: var(--white);
      min-width: 180px;
      box-shadow: var(--shadow-medium);
      z-index: 1001;
      border-radius: 8px;
      overflow: hidden; /* Per bordi arrotondati */
      border: 1px solid var(--gray-light);
    }

    .user-dropdown .dropdown-menu a {
      color: var(--dark);
      padding: 0.8rem 1.2rem;
      text-decoration: none;
      display: block;
      font-size: 0.95rem;
      white-space: nowrap; /* Evita che il testo vada a capo */
    }

    .user-dropdown .dropdown-menu a:hover {
      background-color: var(--light);
      color: var(--primary);
    }
    .user-dropdown .dropdown-menu a:last-child {
      border-top: 1px solid var(--gray-light); /* Separatore per Esci */
      color: var(--accent); /* Colore diverso per Esci */
    }
    .user-dropdown .dropdown-menu a:last-child:hover {
      background-color: #fbeadf; /* Sfondo leggermente diverso per Esci */
    }

    .user-dropdown.show .dropdown-menu {
      display: block;
      animation: fadeIn 0.2s ease-out;
    }
    .user-dropdown .dropdown-arrow {
      font-size: 0.8rem;
      transition: transform var(--transition-fast);
    }
    .user-dropdown.show .dropdown-arrow {
      transform: rotate(180deg);
    }

    .avatar-options {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.5rem;
    }

    .avatar-option {
      font-size: 2rem;
      padding: 0.8rem;
      border-radius: 50%;
      cursor: pointer;
      transition: var(--transition-medium);
      background: var(--gray-light);
      width: 50px; /* Dimensione fissa */
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid transparent;
    }

    .avatar-option:hover {
      transform: scale(1.1);
      background: var(--light);
    }
    .avatar-option.selected {
      border-color: var(--secondary);
      background-color: var(--light);
      box-shadow: 0 0 0 3px rgba(141, 177, 135, 0.3);
    }
  </style>
</head>
<body>

<header class="navbar-container" id="navbarContainer">
  <nav class="navbar">
    <div class="logo">
      <a href="index.html">
        <span class="emoji">üèîÔ∏è</span>
        <h2>Eremo Frate Francesco</h2>
      </a>
    </div>
    <div class="menu">
      <a href="chi-siamo.html">Chi siamo</a>
      <span class="separator">|</span>
      <a href="eventiincorso.html">Calendario attivit√†</a>
      <a href="eventipassati.html">Archivio attivit√†</a>
      <span class="separator">|</span>
      <a href="incontrisullaparola.html">Incontri sulla parola</a>
      <span class="separator">|</span>
      <a href="dovesiamo.html">Dove siamo</a>
      <a href="contatti.html">Contatti</a>
    </div>
    <div class="right-menu">
      <div class="user-dropdown" id="userDropdownContainer">
        <button class="user-btn" onclick="toggleUserMenu()" aria-haspopup="true" aria-expanded="false">
          <span class="user-avatar" id="navbar-avatar">üë§</span> <span class="user-name" id="navbar-username">Admin</span> <span class="dropdown-arrow">‚ñº</span>
        </button>
        <div class="dropdown-menu" aria-labelledby="userDropdownContainer">
          <a href="areapersonale.html">Il mio profilo</a>
          <a href="areapersonale.html#prenotazioni">Le mie prenotazioni</a> <a href="#" onclick="logout()">Esci</a> </div>
      </div>
      <button class="hamburger" onclick="toggleMobileMenu()" aria-label="Toggle menu">‚ò∞</button>
    </div>
  </nav>
  <div class="mobile-menu" id="mobileMenu">
    <a href="chi-siamo.html" onclick="closeMobileMenu()">Chi siamo</a>
    <a href="eventiincorso.html" onclick="closeMobileMenu()">Calendario attivit√†</a>
    <a href="eventipassati.html" onclick="closeMobileMenu()">Archivio attivit√†</a>
    <a href="incontrisullaparola.html" onclick="closeMobileMenu()">Incontri sulla parola</a>
    <a href="dovesiamo.html" onclick="closeMobileMenu()">Dove siamo</a>
    <a href="contatti.html" onclick="closeMobileMenu()">Contatti</a>
    <a href="#" id="login-btn-mobile" onclick="openLoginPopup(); closeMobileMenu();">Accedi</a>
  </div>
</header>

<main>
  <div class="container section-padding">
    <h1 class="text-center mb-4">Calendario Attivit√†</h1>

    <div class="card-grid" id="eventiGrid">
      <article class="card">
        <div class="card-image-container">
          <img src="https://picsum.photos/400/250?random=meditation,spirituality" alt="Meditazione profonda" class="card-image">
        </div>
        <div class="card-content">
          <h3>Ritiro di Meditazione Profonda</h3>
          <p class="card-info">
            <b>Data:</b> 15-17 Maggio 2025 <br>
            <b>Relatore:</b> Fra' Elia <br>
            <b>Orario:</b> Dalle 18:00 del 15
          </p>
          <p>Un weekend immersivo per esplorare tecniche meditative e ritrovare la calma interiore.</p>
          <p class="card-info"><b>Posti Disponibili:</b> <span class="posti-disponibili">12</span></p>
          <div class="card-actions">
            <a href="evento.html?id=1" class="card-btn card-btn-secondary">Dettagli</a>
            <button class="card-btn card-btn-primary btn-prenota-rapido" data-event-id="1">Prenota</button>
          </div>
        </div>
      </article>

      <article class="card">
        <div class="card-image-container">
          <img src="https://picsum.photos/400/250?random=scripture,study" alt="Studio della parola" class="card-image">
        </div>
        <div class="card-content">
          <h3>Incontro sulla Parola: Il Vangelo di Marco</h3>
          <p class="card-info">
            <b>Data:</b> Ogni Gioved√¨ di Maggio 2025 <br>
            <b>Relatore:</b> Sorella Chiara <br>
            <b>Orario:</b> 20:30 - 22:00
          </p>
          <p>Approfondimento settimanale del Vangelo di Marco, aperto a tutti.</p>
          <p class="card-info"><b>Posti Disponibili:</b> <span class="posti-disponibili">30</span></p>
          <div class="card-actions">
            <a href="evento.html?id=2" class="card-btn card-btn-secondary">Dettagli</a>
            <button class="card-btn card-btn-primary btn-prenota-rapido" data-event-id="2">Prenota</button>
          </div>
        </div>
      </article>

      <article class="card">
        <div class="card-image-container">
          <img src="https://picsum.photos/400/250?random=nature,walk" alt="Camminata contemplativa" class="card-image">
        </div>
        <div class="card-content">
          <h3>Camminata Contemplativa nel Bosco</h3>
          <p class="card-info">
            <b>Data:</b> 24 Maggio 2025 <br>
            <b>Guida:</b> Antonio Verdi <br>
            <b>Orario:</b> 09:00 - 13:00
          </p>
          <p>Un percorso guidato nei sentieri dell'Eremo, unendo movimento e riflessione.</p>
          <p class="card-info"><b>Posti Disponibili:</b> <span class="posti-disponibili">8</span></p>
          <div class="card-actions">
            <a href="evento.html?id=3" class="card-btn card-btn-secondary">Dettagli</a>
            <button class="card-btn card-btn-primary btn-prenota-rapido" data-event-id="3">Prenota</button>
          </div>
        </div>
      </article>

    </div>

  </div>
</main>

<div class="login-popup-overlay" id="loginOverlay"></div>
<div class="login-popup" id="loginPopup">
  <button class="close-popup" id="closePopup" aria-label="Chiudi popup">&times;</button>
  <div class="login-tabs">
    <div class="login-tab active" data-tab="login">Accedi</div>
    <div class="login-tab" data-tab="register">Registrati</div>
  </div>
  <form class="login-form active" id="loginForm">
    <div class="form-group mb-3">
      <label for="login-email">Email</label>
      <input type="email" id="login-email-popup" class="form-control" required>
    </div>
    <div class="form-group mb-3">
      <label for="login-password">Password</label>
      <input type="password" id="login-password-popup" class="form-control" required>
    </div>
    <div class="form-actions">
      <button type="submit" class="btn-popup">Accedi</button>
    </div>
  </form>
  <form class="login-form" id="registerForm">
    <div class="form-actions">
      <button type="submit" class="btn-popup">Registrati</button>
    </div>
  </form>
</div>

<footer>
  <p>&copy; 2025 Eremo Frate Francesco. Tutti i diritti riservati. Via della Spiritualit√† 123, Nembro (BG) - Italia</p>
</footer>

<script>
  // --- Navbar & Mobile Menu Logic (come index.html) ---
  // ... (includere lo script completo) ...
  let lastScroll = 0;
  const navbarContainer = document.getElementById('navbarContainer');
  window.addEventListener('scroll', function() { /* ... */ });
  const mobileMenu = document.getElementById("mobileMenu");
  const hamburger = document.querySelector(".hamburger");
  function toggleMobileMenu() { /* ... */ }
  function closeMobileMenu() { /* ... */ }

  // --- Login Popup Logic (come index.html) ---
  const loginBtn = document.getElementById('login-btn');
  // ... (includere lo script completo del popup) ...
  function openLoginPopup() { /* ... */ }
  function closeLoginPopup() { /* ... */ }
  // ... event listeners popup ...


  // --- Logica specifica pagina Eventi ---

  // Esempio: Gestione prenotazione rapida (richiede login)
  document.querySelectorAll('.btn-prenota-rapido').forEach(button => {
    button.addEventListener('click', function() {
      const eventId = this.getAttribute('data-event-id');
      // 1. Controlla se l'utente √® loggato (es. check cookie/localStorage)
      const isLoggedIn = false; // Mettere qui la logica di controllo login

      if (isLoggedIn) {
        // 2. Se loggato, procedi con la prenotazione (simulata)
        console.log(`Tentativo prenotazione evento ${eventId}`);
        this.textContent = 'Prenotato!';
        this.disabled = true;
        // Qui aggiungere chiamata API reale per prenotare
        alert(`Prenotazione per evento ${eventId} effettuata (simulato).`);
      } else {
        // 3. Se non loggato, apri il popup di login
        openLoginPopup();
        // Potresti voler salvare l'ID evento per completare la prenotazione dopo il login
        localStorage.setItem('pending_booking_event_id', eventId);
      }
    });
  });

  // Esempio: dopo il login/registrazione dal popup, controlla se c'era una prenotazione in sospeso
  document.getElementById('loginForm')?.addEventListener('submit', (e) => {
    e.preventDefault();
    // ... logica login ...
    const pendingEventId = localStorage.getItem('pending_booking_event_id');
    if (pendingEventId) {
      alert(`Login effettuato. Completa prenotazione per evento ${pendingEventId}?`);
      // Qui logica per completare la prenotazione
      localStorage.removeItem('pending_booking_event_id');
    }
    closeLoginPopup();
  });
  document.getElementById('registerForm')?.addEventListener('submit', (e) => {
    // ... logica registrazione ...
    // Simile al login, controlla pendingEventId
  });

</script>

<script>
  // --- Navbar & Mobile Menu Logic (come index.html) ---
  let lastScroll = 0;
  const navbarContainer = document.getElementById('navbarContainer');
  window.addEventListener('scroll', function() { /* ... */ });
  const mobileMenu = document.getElementById("mobileMenu");
  const hamburger = document.querySelector(".hamburger");
  function toggleMobileMenu() { /* ... */ }
  function closeMobileMenu() { /* ... */ }

  // --- User Dropdown Logic ---
  function toggleUserMenu() {
    const dropdown = document.querySelector('.user-dropdown');
    const isOpen = dropdown.classList.toggle('show');
    dropdown.querySelector('.user-btn').setAttribute('aria-expanded', isOpen);
  }

  // Chiudi dropdown se si clicca fuori
  document.addEventListener('click', function(event) {
    const dropdown = document.querySelector('.user-dropdown');
    if (dropdown && !dropdown.contains(event.target)) {
      dropdown.classList.remove('show');
      dropdown.querySelector('.user-btn').setAttribute('aria-expanded', 'false');
    }
  });

  // --- Logica Area Personale ---

  // Dati Utente (simulati, dovrebbero venire dal backend/localStorage)
  const userData = {
    nome: "Mario",
    cognome: "Rossi",
    email: "mario.rossi@example.com",
    telefono: "+39 123 456789",
    avatar: "üßò" // Avatar selezionato
  };

  // Popola campi all'avvio
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('nome').value = userData.nome;
    document.getElementById('cognome').value = userData.cognome;
    document.getElementById('email').value = userData.email;
    document.getElementById('telefono').value = userData.telefono || '';
    document.getElementById('profile-greeting').textContent = `Ciao, ${userData.nome}!`;
    document.getElementById('navbar-username').textContent = userData.nome; // Aggiorna nome navbar

    // Imposta avatar selezionato
    document.getElementById('main-avatar').textContent = userData.avatar;
    document.getElementById('navbar-avatar').textContent = userData.avatar; // Aggiorna avatar navbar
    document.querySelectorAll('.avatar-option').forEach(opt => {
      if (opt.getAttribute('data-emoji') === userData.avatar) {
        opt.classList.add('selected');
      } else {
        opt.classList.remove('selected');
      }
    });

    // Mostra/Nascondi messaggio prenotazioni (simulato)
    const bookingsGrid = document.getElementById('user-bookings-grid');
    const noBookingsMsg = document.getElementById('no-bookings-message');
    if (bookingsGrid.children.length <= 1) { // Controlla se ci sono solo card "vere"
      noBookingsMsg.style.display = 'block';
    }
  });

  // Gestione Selezione Avatar
  const avatarOptions = document.querySelectorAll('.avatar-option');
  const mainAvatar = document.getElementById('main-avatar');
  const navbarAvatar = document.getElementById('navbar-avatar');
  let selectedAvatarEmoji = userData.avatar; // Tiene traccia dell'avatar selezionato

  avatarOptions.forEach(option => {
    option.addEventListener('click', function() {
      avatarOptions.forEach(opt => opt.classList.remove('selected'));
      this.classList.add('selected');
      selectedAvatarEmoji = this.getAttribute('data-emoji');
      // Aggiorna subito l'anteprima, ma salva solo al click su "Salva Icona"
      mainAvatar.textContent = selectedAvatarEmoji;
    });
  });

  // Salvataggio Icona
  document.getElementById('save-avatar-btn')?.addEventListener('click', () => {
    userData.avatar = selectedAvatarEmoji;
    navbarAvatar.textContent = userData.avatar; // Aggiorna anche navbar
    // Qui logica per salvare l'avatar nel backend/localStorage
    alert('Icona profilo aggiornata!');
  });

  // Salvataggio Info Personali
  document.getElementById('profile-info-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    userData.nome = document.getElementById('nome').value;
    userData.cognome = document.getElementById('cognome').value;
    userData.telefono = document.getElementById('telefono').value;
    // Aggiorna UI
    document.getElementById('profile-greeting').textContent = `Ciao, ${userData.nome}!`;
    document.getElementById('navbar-username').textContent = userData.nome;
    // Qui logica per salvare i dati nel backend/localStorage
    alert('Informazioni personali aggiornate!');
  });

  // Cambio Password
  document.getElementById('password-change-form')?.addEventListener('submit', (e) => {
    e.preventDefault();
    const oldPass = document.getElementById('vecchia-password').value;
    const newPass = document.getElementById('nuova-password').value;
    const confirmPass = document.getElementById('conferma-password').value;

    if (newPass !== confirmPass) {
      alert('Le nuove password non coincidono!');
      return;
    }
    if (newPass.length < 8) {
      alert('La nuova password deve essere di almeno 8 caratteri.');
      return;
    }
    // Qui logica per verificare vecchia password e salvare la nuova nel backend
    console.log("Tentativo cambio password:", { oldPass, newPass });
    alert('Password aggiornata con successo (simulato)!');
    // Resetta i campi password
    document.getElementById('vecchia-password').value = '';
    document.getElementById('nuova-password').value = '';
    document.getElementById('conferma-password').value = '';
  });

  // Annulla Prenotazione (Simulato)
  document.querySelectorAll('.btn-annulla-prenotazione').forEach(button => {
    button.addEventListener('click', function() {
      const bookingId = this.getAttribute('data-booking-id');
      if (confirm('Sei sicuro di voler annullare questa prenotazione?')) {
        console.log(`Annullamento prenotazione ${bookingId}`);
        // Qui logica API per annullare
        this.closest('.card').style.opacity = '0.5';
        this.textContent = 'Annullata';
        this.disabled = true;
        alert(`Prenotazione ${bookingId} annullata (simulato).`);
      }
    });
  });


  // Funzione Logout (Simulata)
  function logout() {
    // Qui logica per invalidare sessione/token/cookie
    alert('Logout effettuato (simulato). Verrai reindirizzato alla homepage.');
    window.location.href = 'index.html'; // Reindirizza alla homepage
  }

</script>
</body>
</html>