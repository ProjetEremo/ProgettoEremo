<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="images/logo.png" type="image/x-icon"> <title>Eremo Frate Francesco - Benvenuti</title>
  <link rel="stylesheet" href="style.css"> <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Roboto:wght@300;400;500;700&family=Segoe+UI:wght@400;600&display=swap" rel="stylesheet">

  <style>
    .login-popup input.form-control {
      transition: border-color 0.3s ease;
      border: 1px solid #ced4da;
    }

    .login-popup input.error-border {
      border-color: red !important;
    }

    /* Stile per input autofill per evitare sfondo giallo/blu di Chrome */
    .login-popup input:-webkit-autofill,
    .login-popup input:-webkit-autofill:hover,
    .login-popup input:-webkit-autofill:focus,
    .login-popup input:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 30px white inset !important; /* Sfondo bianco */
      -webkit-text-fill-color: #333 !important; /* Colore testo normale */
      transition: background-color 5000s ease-in-out 0s; /* Evita transizione colore */
    }
    .login-popup .form-message {
      font-size: 0.85rem;
      margin-top: 0.5rem;
      text-align: center;
    }
    .login-popup .form-message.error { color: red; }
    .login-popup .form-message.success { color: green; }

  </style>
</head>

<body class="page-index"> <header class="navbar-container" id="navbarContainer">
  <nav class="navbar">
    <div class="logo">
      <a href="index.html">
        <span class="emoji">üèîÔ∏è</span>
        <h2>Eremo Frate Francesco</h2>
      </a>
    </div>
    <div class="menu">
      <a href="eventiincorso.html">Calendario attivit√†</a>
      <a href="eventipassati.html">Archivio attivit√†</a>
      <span class="separator">|</span>
      <a href="incontrisullaparola.html">Incontri sulla parola</a>
      <span class="separator">|</span>
      <a href="dovesiamo.html">Dove siamo</a>
      <a href="contatti.html">Contatti</a>
    </div>
    <div class="right-menu"> <button id="login-btn" class="login-btn">Accedi</button>
      <button class="hamburger" onclick="toggleMobileMenu()" aria-label="Toggle menu">‚ò∞</button>
    </div>
  </nav>
  <div class="mobile-menu" id="mobileMenu">
    <a href="eventiincorso.html" onclick="closeMobileMenu()">Calendario attivit√†</a>
    <a href="eventipassati.html" onclick="closeMobileMenu()">Archivio attivit√†</a>
    <a href="incontrisullaparola.html" onclick="closeMobileMenu()">Incontri sulla parola</a>
    <a href="dovesiamo.html" onclick="closeMobileMenu()">Dove siamo</a>
    <a href="contatti.html" onclick="closeMobileMenu()">Contatti</a>
    <a href="#" id="login-btn-mobile" onclick="openLoginPopup(); closeMobileMenu();">Accedi</a>
  </div>
</header>

<main>
  <section class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Eremo Frate Francesco</h1>
      <p class="hero-subtitle">In ascolto della Parola, in cammino nella fraternit√†</p>
    </div>
  </section>

  <section class="section-padding">
    <div class="container">
      <section class="chi-siamo-section section-padding">
        <div class="chi-siamo-image-container">
          <img src="https://picsum.photos/600/400?random=group,reading,discussion" alt="Gruppo di studio biblico" class="chi-siamo-image">
        </div>
        <div class="chi-siamo-content">
          <h2>La Fraternit√†</h2>
          <p>La Fraternit√† Eremo Frate Francesco, nata nel 1992 attorno alla Parola di Dio sotto la
            guida di padre Maurizio Novelli secondo il metodo della ‚ÄúLectio Divina‚Äù, √® una
            organizzazione di volontari cristiani che condividono uno stile di vita comunitario e
            fraterno; non ha scopo di lucro e persegue finalit√† civiche, solidaristiche e di utilit√† sociale.</p>
        </div>
      </section>

      <section class="chi-siamo-section section-padding">
        <div class="chi-siamo-content">
          <h2>L'Ascolto</h2>
          <p>Questo ascolto comunitario sempre pi√π profondo della Scrittura √® fondamentale per la
            nostra identit√† ed ha fatto nascere l‚Äôesigenza di uno spazio silenzioso, un‚Äù piccolo Eremo‚Äù
            per custodire insieme tutto ci√≤ che ci √® stato offerto: la vita, la terra, la Parola, la pace, la
            fratellanza.
            Un luogo dove ritrovarsi e ripartire.
            Un tempo per ascoltare e riscoprire Dio dentro di noi, una risposta consapevole e
            responsabile alla sua Presenza che si apre a un servizio all‚Äôumanit√† e promuove il dialogo
            interreligioso</p>
        </div>
        <div class="chi-siamo-image-container">
          <img src="https://picsum.photos/600/400?random=group,reading,discussion" alt="Gruppo di studio biblico" class="chi-siamo-image">
        </div>
      </section>

      <section class="chi-siamo-section section-padding">
        <div class="chi-siamo-image-container">
          <img src="https://picsum.photos/600/400?random=group,reading,discussion" alt="Gruppo di studio biblico" class="chi-siamo-image">
        </div>
        <div class="chi-siamo-content">
          <h2>L'Accoglienza</h2>
          <p>All‚ÄôEremo accogliamo adulti e giovani, singoli e gruppi, sacerdoti e religiosi che desiderano
            trascorrere uno o pi√π giorni in un clima di silenzio, di ascolto, di preghiera e di fraternit√†;
            promuoviamo momenti di spiritualit√† e di meditazione, incontri di formazione e convegni
            su tematiche religiose e sociali, attivit√† culturali e artistiche.</p>
        </div>
      </section>
    </div>
  </section>


</main>

<div class="login-popup-overlay" id="loginOverlay"></div>
<div class="login-popup" id="loginPopup">
  <button class="close-popup" id="closePopup" aria-label="Chiudi popup">&times;</button>
  <div class="login-tabs">
    <div class="login-tab active" data-tab="login">Accedi</div>
    <div class="login-tab" data-tab="register">Registrati</div>
  </div>
  <form class="login-form active" id="loginForm" method="POST">
    <div class="form-group mb-3">
      <label for="login-email">Email</label>
      <input type="email" id="login-email" name="login-email" class="form-control" required autocomplete="email">
    </div>
    <div class="form-group mb-3">
      <label for="login-password">Password</label>
      <input type="password" id="login-password" name="login-password" class="form-control" required autocomplete="current-password">
    </div>
    <div id="login-error-message" class="form-message error" style="display: none;"></div>
    <div class="form-actions">
      <button type="submit" class="btn-popup">Accedi</button>
    </div>
  </form>
  <form class="login-form" id="registerForm" method="POST">
    <div class="form-group mb-3">
      <label for="register-name">Nome</label>
      <input type="text" id="register-name" name="register-name" class="form-control" required autocomplete="given-name">
    </div>
    <div class="form-group mb-3">
      <label for="register-surname">Cognome</label>
      <input type="text" id="register-surname" name="register-surname" class="form-control" required autocomplete="family-name">
    </div>
    <div class="form-group mb-3">
      <label for="register-email">Email</label>
      <input type="email" id="register-email" name="register-email" class="form-control" required autocomplete="email">
    </div>
    <div class="form-group mb-3">
      <label for="register-password">Password</label>
      <input type="password" id="register-password" name="register-password" class="form-control" required minlength="8" autocomplete="new-password">
      <small>Minimo 8 caratteri.</small>
    </div>
    <div class="terms-checkbox mb-3">
      <input type="checkbox" id="register-terms" name="register-terms" required>
      <label for="register-terms">Accetto i <a href="/termini" target="_blank">termini e condizioni</a></label>
    </div>
    <div id="register-message" class="form-message" style="display: none;"></div>
    <div class="form-actions">
      <button type="submit" class="btn-popup">Registrati</button>
    </div>
  </form>
</div>

<footer>
  <p>¬© <span id="currentYear"></span> Eremo Frate Francesco. Tutti i diritti riservati. Via della Spiritualit√† 123, Nembro (BG) - Italia</p>
</footer>

<script>
  // --- Navbar Scroll Logic ---
  let lastScroll = 0;
  const navbarContainer = document.getElementById('navbarContainer');
  if (navbarContainer) {
    window.addEventListener('scroll', function() {
      const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
      if (currentScroll <= 50) {
        navbarContainer.classList.remove('hidden');
        lastScroll = 0;
        return;
      }
      if (currentScroll > lastScroll && !navbarContainer.classList.contains('hidden')) {
        navbarContainer.classList.add('hidden');
      } else if (currentScroll < lastScroll && navbarContainer.classList.contains('hidden')) {
        navbarContainer.classList.remove('hidden');
      }
      lastScroll = currentScroll;
    }, false);
  }

  // --- Mobile Menu Logic ---
  const mobileMenu = document.getElementById("mobileMenu");
  const hamburger = document.querySelector(".navbar .hamburger");
  function toggleMobileMenu() {
    if(mobileMenu && hamburger) {
      const isOpen = mobileMenu.classList.toggle("open");
      hamburger.setAttribute("aria-expanded", isOpen.toString());
      document.body.style.overflow = isOpen ? 'hidden' : '';
    }
  }
  function closeMobileMenu() {
    if(mobileMenu && hamburger) {
      mobileMenu.classList.remove("open");
      hamburger.setAttribute("aria-expanded", "false");
      document.body.style.overflow = '';
    }
  }
  document.addEventListener('click', function(event) {
    if (mobileMenu && mobileMenu.classList.contains('open') &&
            hamburger && !mobileMenu.contains(event.target) &&
            !hamburger.contains(event.target)) {
      closeMobileMenu();
    }
  });

  // --- Login Popup Logic ---
  const loginBtn = document.getElementById('login-btn');
  const loginBtnMobile = document.getElementById('login-btn-mobile');
  const loginOverlay = document.getElementById('loginOverlay');
  const loginPopup = document.getElementById('loginPopup');
  const closePopupBtn = document.getElementById('closePopup');
  const loginTabs = document.querySelectorAll('.login-tab');
  const loginForms = document.querySelectorAll('.login-form');
  const loginErrorMessageEl = document.getElementById('login-error-message');
  const registerMessageEl = document.getElementById('register-message');


  function openLoginPopup() {
    if(loginOverlay) loginOverlay.classList.add('active');
    if(loginPopup) loginPopup.classList.add('active');
    document.body.style.overflow = 'hidden';
    if(loginErrorMessageEl) loginErrorMessageEl.style.display = 'none'; // Nascondi errore precedente
    if(registerMessageEl) registerMessageEl.style.display = 'none'; // Nascondi messaggio precedente
  }

  function closeLoginPopup() {
    if(loginOverlay) loginOverlay.classList.remove('active');
    if(loginPopup) loginPopup.classList.remove('active');
    document.body.style.overflow = '';
  }

  if (loginBtn) {
    loginBtn.addEventListener('click', (e) => { e.preventDefault(); openLoginPopup(); });
  }
  if (loginBtnMobile) {
    loginBtnMobile.addEventListener('click', (e) => { e.preventDefault(); closeMobileMenu(); openLoginPopup(); });
  }

  if(closePopupBtn) { closePopupBtn.addEventListener('click', closeLoginPopup); }
  if(loginOverlay) { loginOverlay.addEventListener('click', (e) => { if(e.target === loginOverlay) closeLoginPopup(); }); }

  loginTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const tabId = tab.getAttribute('data-tab');
      loginTabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      loginForms.forEach(form => {
        form.classList.remove('active');
        if (form.id === `${tabId}Form`) {
          form.classList.add('active');
        }
      });
      if(loginErrorMessageEl) loginErrorMessageEl.style.display = 'none';
      if(registerMessageEl) registerMessageEl.style.display = 'none';
    });
  });

  function resetLoginErrorVisuals() {
    const emailInput = document.getElementById('login-email');
    const passwordInput = document.getElementById('login-password');
    if(emailInput) emailInput.classList.remove('error-border');
    if(passwordInput) passwordInput.classList.remove('error-border');
    if(loginErrorMessageEl) loginErrorMessageEl.style.display = 'none';
  }

  document.getElementById('login-email')?.addEventListener('input', resetLoginErrorVisuals);
  document.getElementById('login-password')?.addEventListener('input', resetLoginErrorVisuals);


  // LOGIN
  const loginForm = document.getElementById('loginForm');
  if (loginForm) {
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const loginButton = e.target.querySelector('button[type="submit"]');
      const originalButtonText = loginButton.innerHTML;
      loginButton.disabled = true;
      loginButton.innerHTML = 'Accesso...';

      resetLoginErrorVisuals(); // Resetta errori visivi

      const emailInput = document.getElementById('login-email'); // Definisci qui per usarlo dopo

      try {
        const response = await fetch('login.php', {
          method: 'POST',
          body: new FormData(e.target)
        });

        if (!response.ok) throw new Error(`Errore HTTP: ${response.status}`);

        const result = await response.json();

        if (result.success) {
          // **INIZIO MODIFICA PER LOCALSTORAGE**
          const userToStore = {
            email: emailInput.value, // Prendi l'email dal campo di input
            // Aggiungi qui altri dati utente se login.php li restituisce e ti servono
            // Ad esempio, se login.php restituisse 'nome': result.nome
            // Per ora, le pagine *accesso.html usano l'email per derivare il nome utente se 'nome' non c'√®.
            // 'is_admin' √® cruciale per il reindirizzamento e potenzialmente per altre logiche.
            is_admin: result.is_admin
          };
          localStorage.setItem('userDataEFF', JSON.stringify(userToStore));
          // **FINE MODIFICA PER LOCALSTORAGE**

          closeLoginPopup();
          // Reindirizza alla pagina corretta
          window.location.href = result.is_admin ? 'indexadmin.html' : 'indexaccesso.html';

        } else {
          if(emailInput) emailInput.classList.add('error-border');
          const passwordInput = document.getElementById('login-password');
          if(passwordInput) passwordInput.classList.add('error-border');
          if(loginErrorMessageEl) {
            loginErrorMessageEl.textContent = result.message || 'Credenziali non valide.';
            loginErrorMessageEl.style.display = 'block';
          }
        }
      } catch (error) {
        if(emailInput) emailInput.classList.add('error-border');
        const passwordInput = document.getElementById('login-password');
        if(passwordInput) passwordInput.classList.add('error-border');
        if(loginErrorMessageEl) {
          loginErrorMessageEl.textContent = "Errore di connessione o risposta dal server non valida.";
          loginErrorMessageEl.style.display = 'block';
        }
        console.error("Errore login:", error);
      } finally {
        loginButton.disabled = false;
        loginButton.innerHTML = originalButtonText;
      }
    });
  }

  // REGISTRAZIONE
  const registerForm = document.getElementById('registerForm');
  if (registerForm) {
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const registerButton = e.target.querySelector('button[type="submit"]');
      const originalButtonText = registerButton.innerHTML;
      registerButton.disabled = true;
      registerButton.innerHTML = 'Registrazione...';
      if(registerMessageEl) registerMessageEl.style.display = 'none';


      try {
        const response = await fetch('registrati.php', {
          method: 'POST',
          body: new FormData(e.target)
        });

        if (!response.ok) {
          let errorMsg = `Errore HTTP: ${response.status} ${response.statusText}`;
          try { const errorData = await response.json(); errorMsg = errorData.message || errorMsg; }
          catch(jsonError) { /* ignora se il corpo non √® json valido */ }
          throw new Error(errorMsg);
        }

        const result = await response.json();

        if (result.success) {
          if(registerMessageEl) {
            registerMessageEl.textContent = result.message || "Registrazione completata! Ora puoi accedere.";
            registerMessageEl.className = 'form-message success'; // Usa classe success
            registerMessageEl.style.display = 'block';
          }
          // Opzionale: pulisci il form o passa alla tab di login
          // e.target.reset();
          // document.querySelector('.login-tab[data-tab="login"]').click();
        } else {
          if(registerMessageEl) {
            registerMessageEl.textContent = "Errore: " + (result.message || "Si √® verificato un errore.");
            registerMessageEl.className = 'form-message error'; // Usa classe error
            registerMessageEl.style.display = 'block';
          }
        }
      } catch (error) {
        if(registerMessageEl) {
          registerMessageEl.textContent = "Errore durante la registrazione: " + error.message;
          registerMessageEl.className = 'form-message error';
          registerMessageEl.style.display = 'block';
        }
        console.error("Dettaglio errore registrazione:", error);
      } finally {
        registerButton.disabled = false;
        registerButton.innerHTML = originalButtonText;
      }
    });
  }

  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape' && loginPopup && loginPopup.classList.contains('active')) {
      closeLoginPopup();
    }
  });

  const currentYearSpan = document.querySelector("footer p span");
  if (currentYearSpan) {
    currentYearSpan.textContent = new Date().getFullYear();
  }

</script>

</body>
</html>