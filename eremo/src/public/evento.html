<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dettaglio Evento - Eremo Frate Francesco</title> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header class="navbar-container" id="navbarContainer">
    <nav class="navbar">
        <div class="logo">
            <a href="index.html"><span class="emoji">üèîÔ∏è</span><h2>Eremo Frate Francesco</h2></a>
        </div>
        <div class="menu">
            <a href="chi-siamo.html">Chi siamo</a><span class="separator">|</span>
            <a href="eventiincorso.html">Calendario attivit√†</a>
            <a href="eventipassati.html">Archivio attivit√†</a><span class="separator">|</span>
            <a href="incontrisullaparola.html">Incontri sulla parola</a><span class="separator">|</span>
            <a href="dovesiamo.html">Dove siamo</a>
            <a href="contatti.html">Contatti</a>
        </div>
        <div class="right-menu">
            <button id="login-btn" class="login-btn">Accedi</button>
            <button class="hamburger" onclick="toggleMobileMenu()" aria-label="Toggle menu">‚ò∞</button>
        </div>
    </nav>
    <div class="mobile-menu" id="mobileMenu">
        <a href="chi-siamo.html" onclick="closeMobileMenu()">Chi siamo</a>
        <a href="eventiincorso.html" onclick="closeMobileMenu()">Calendario attivit√†</a>
        <a href="eventipassati.html" onclick="closeMobileMenu()">Archivio attivit√†</a>
        <a href="incontrisullaparola.html" onclick="closeMobileMenu()">Incontri sulla parola</a>
        <a href="dovesiamo.html" onclick="closeMobileMenu()">Dove siamo</a>
        <a href="contatti.html" onclick="closeMobileMenu()">Contatti</a>
        <a href="#" id="login-btn-mobile" onclick="openLoginPopup(); closeMobileMenu();">Accedi</a>
    </div>
</header>

<main>
    <div class="container section-padding">
        <div class="evento-main-grid">

            <div class="evento-details">
                <h1 class="evento-title">Ritiro di Meditazione Profonda</h1>
                <div class="evento-meta">
                    <span><i class="fas fa-calendar-alt"></i> 15-17 Maggio 2025</span>
                    <span><i class="fas fa-user"></i> Fra' Elia</span>
                    <span><i class="fas fa-map-marker-alt"></i> Eremo Frate Francesco</span>
                    <span><i class="fas fa-tag"></i> Ritiro Spirituale</span>
                </div>

                <div class="evento-description">
                    <h2>Descrizione dell'Evento</h2>
                    <p>Un weekend dedicato all'esplorazione interiore attraverso pratiche meditative guidate e momenti di profondo silenzio. Questo ritiro √® un invito a staccare dalla routine quotidiana per riconnettersi con s√© stessi e con la dimensione spirituale.</p>
                    <p>Guidati da Fra' Elia, esperto di meditazione contemplativa, i partecipanti apprenderanno tecniche per calmare la mente, coltivare la consapevolezza e aprire il cuore. Il programma include sessioni di meditazione seduta e camminata, insegnamenti spirituali, momenti di condivisione (facoltativi) e tempo personale per la riflessione nella splendida cornice naturale dell'Eremo.</p>
                    <h3>A chi √® rivolto?</h3>
                    <p>Il ritiro √® aperto a tutti, sia a principianti che a praticanti esperti di meditazione.</p>
                    <ul>
                        <li>Ridurre stress e ansia.</li>
                        <li>Approfondire la pratica meditativa.</li>
                        <li>Vivere un'esperienza di silenzio rigenerante.</li>
                    </ul>
                    <h3>Programma Indicativo</h3>
                    <ul>
                        <li><strong>Venerd√¨:</strong> Accoglienza, introduzione, meditazione serale.</li>
                        <li><strong>Sabato:</strong> Meditazione, insegnamenti, camminata, tempo personale.</li>
                        <li><strong>Domenica:</strong> Meditazione, condivisione, saluti.</li>
                    </ul>
                </div>

                <section class="media-gallery">
                    <h3>Galleria Immagini</h3>
                    <div class="gallery-grid">
                        <div class="gallery-item">
                            <a href="images/gallery/meditazione_gruppo_large.jpg" data-lightbox="event-gallery" data-title="Sessione di meditazione">
                                <img src="images/gallery/meditazione_gruppo_thumb.jpg" alt="Sessione di meditazione">
                            </a>
                        </div>
                        <div class="gallery-item">
                            <a href="images/gallery/eremo_vista_large.jpg" data-lightbox="event-gallery" data-title="Vista dall'Eremo">
                                <img src="images/gallery/eremo_vista_thumb.jpg" alt="Vista dall'Eremo">
                            </a>
                        </div>
                        <div class="gallery-item">
                            <a href="images/gallery/sentiero_large.jpg" data-lightbox="event-gallery" data-title="Sentiero per la meditazione camminata">
                                <img src="images/gallery/sentiero_thumb.jpg" alt="Sentiero meditazione">
                            </a>
                        </div>
                        <div class="gallery-item">
                            <a href="images/gallery/candele_large.jpg" data-lightbox="event-gallery" data-title="Atmosfera serale">
                                <img src="images/gallery/candele_thumb.jpg" alt="Atmosfera serale">
                            </a>
                        </div>
                    </div>
                </section>

                <section class="comments-section">
                    <h3>Lascia un commento o una domanda</h3>
                    <div class="comment-form">
                        <div class="comment-form-container">
                            <textarea id="comment-text" placeholder="Scrivi qui..." aria-label="Testo del commento" rows="4"></textarea>
                            <button id="submit-comment" class="btn-comment">Invia</button>
                        </div>
                    </div>
                    <div class="comments-list" id="comments-list">
                        <h4>Commenti</h4>
                        <div class="comment">
                            <div class="comment-header">
                                <img src="https://www.gravatar.com/avatar/?d=mp&s=40" alt="Avatar utente" class="user-avatar">
                                <div class="comment-meta">
                                    <strong>Maria Bianchi</strong> <small>2 giorni fa</small>
                                </div>
                            </div>
                            <p>Sembra un ritiro meraviglioso! √à necessario avere esperienza pregressa di meditazione?</p>
                            <div class="comment-actions">
                                <button class="like-btn" aria-label="Mi piace"><i class="far fa-heart"></i> <span>3</span></button>
                                <button class="btn-reply" aria-label="Rispondi">Rispondi</button>
                            </div>
                        </div>
                    </div>
                </section>

            </div>

            <aside class="evento-sidebar">
                <div class="booking-box">
                    <div class="price">‚Ç¨ 150</div>
                    <div class="seats">
                        Posti disponibili: <span class="count" id="posti-disponibili">12</span> / 20
                    </div>
                    <button class="btn-prenota-evento" id="btn-prenota-principale" data-event-id="1">
                        Prenota il tuo posto
                    </button>
                </div>

                <div class="volantino-preview">
                    <h4>Volantino</h4>
                    <a href="../images/volantino.png" target="_blank" title="Visualizza/Scarica Volantino">
                        <img src="../images/volantino.png" alt="Anteprima Volantino">
                    </a>
                </div>

                <div class="info-box">
                    <h4>Informazioni Utili</h4>
                    <ul>
                        <li><strong>Alloggio:</strong> Camere singole/doppie disponibili presso l'eremo.</li>
                        <li><strong>Pasti:</strong> Cucina semplice e vegetariana inclusa.</li>
                        <li><strong>Cosa Portare:</strong> Abiti comodi, coperta, tappetino (facolt.), quaderno.</li>
                        <li><strong>Contatti:</strong> Per dubbi, <a href="contatti.html">contattaci</a>.</li>
                    </ul>
                </div>
            </aside>

        </div>
    </div>
</main>

<div class="login-popup-overlay" id="loginOverlay"></div>
<div class="login-popup" id="loginPopup">
    <button class="close-popup" id="closePopup" aria-label="Chiudi popup">√ó</button>
    <div class="login-tabs">
        <div class="login-tab active" data-tab="login">Accedi</div>
        <div class="login-tab" data-tab="register">Registrati</div>
    </div>
    <form class="login-form active" id="loginForm"> ... </form>
    <form class="login-form" id="registerForm"> ... </form>
</div>

<footer>
    <p>¬© 2025 Eremo Frate Francesco. Tutti i diritti riservati. Via della Spiritualit√† 123, Nembro (BG) - Italia</p>
</footer>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

<script>
    // --- Navbar & Mobile Menu Logic (come index.html) ---
    let lastScroll = 0;
    const navbarContainer = document.getElementById('navbarContainer');
    window.addEventListener('scroll', function() { /* ... */ });
    const mobileMenu = document.getElementById("mobileMenu");
    const hamburger = document.querySelector(".hamburger");
    function toggleMobileMenu() { /* ... */ }
    function closeMobileMenu() { /* ... */ }

    // --- Login Popup Logic (come index.html) ---
    const loginBtn = document.getElementById('login-btn');
    // ... (includere script popup completo) ...
    function openLoginPopup() { /* ... */ }
    function closeLoginPopup() { /* ... */ }
    // ... event listeners popup ...

    // --- Logica Specifica Pagina Evento ---
    const eventId = 1; // Dovrebbe essere dinamico in un'app reale
    const totalSeats = 20;
    let availableSeats = 12; // Dovrebbe venire dal backend

    const seatsDisplay = document.getElementById('posti-disponibili');
    const bookingButton = document.getElementById('btn-prenota-principale');

    function updateBookingStatus() {
        if (seatsDisplay) seatsDisplay.textContent = availableSeats;
        if (bookingButton) {
            if (availableSeats <= 0) {
                bookingButton.textContent = 'Posti Esauriti';
                bookingButton.disabled = true;
            } else {
                bookingButton.textContent = 'Prenota il tuo posto';
                bookingButton.disabled = false;
            }
        }
    }

    bookingButton?.addEventListener('click', function() {
        // Stessa logica di prenotazione rapida da eventiincorso.html
        const isLoggedIn = false; // Check login
        if (isLoggedIn) {
            console.log(`Tentativo prenotazione evento ${eventId}`);
            // Simula prenotazione
            if (availableSeats > 0) {
                availableSeats--;
                updateBookingStatus();
                this.textContent = 'Prenotato!';
                this.disabled = true;
                alert(`Prenotazione per evento ${eventId} effettuata (simulato).`);
                // Chiamata API reale
            }
        } else {
            openLoginPopup();
            localStorage.setItem('pending_booking_event_id', eventId);
        }
    });

    // --- Logica Commenti (Semplificata) ---
    const commentText = document.getElementById('comment-text');
    const submitCommentBtn = document.getElementById('submit-comment');
    const commentsList = document.getElementById('comments-list');

    function getGravatar(email, size = 40) {
        const hash = CryptoJS.MD5(email.trim().toLowerCase()).toString();
        // Usa un avatar di default se l'email non √® valida o per utenti non loggati
        return `https://www.gravatar.com/avatar/${hash}?s=${size}&d=mp`; // mp = mystery person
    }

    submitCommentBtn?.addEventListener('click', () => {
        const text = commentText.value.trim();
        // Check login
        const isLoggedIn = false; // Check login
        const userName = isLoggedIn ? "Utente Loggato" : "Ospite"; // Nome utente
        const userAvatar = isLoggedIn ? getGravatar("utente@loggato.it") : getGravatar("");

        if (text) {
            const timestamp = new Date().toLocaleDateString('it-IT', { day: 'numeric', month: 'short', year: 'numeric' });
            const commentHTML = `
                <div class="comment">
                    <div class="comment-header">
                        <img src="${userAvatar}" alt="Avatar" class="user-avatar">
                        <div class="comment-meta">
                            <strong>${userName}</strong> <small>${timestamp}</small>
                        </div>
                    </div>
                    <p>${text.replace(/\n/g, '<br>')}</p> <div class="comment-actions">
                        <button class="like-btn" aria-label="Mi piace"><i class="far fa-heart"></i> <span>0</span></button>
                        <button class="btn-reply" aria-label="Rispondi">Rispondi</button>
                    </div>
                </div>`;
            commentsList.insertAdjacentHTML('beforeend', commentHTML); // Aggiunge in fondo
            commentText.value = ''; // Pulisce textarea
        } else {
            alert("Inserisci un commento prima di inviare.");
        }
    });

    // Aggiungere event listener per like/reply (pi√π complesso)
    commentsList?.addEventListener('click', (e) => {
        if (e.target.closest('.like-btn')) {
            // Logica Like
            const btn = e.target.closest('.like-btn');
            const countSpan = btn.querySelector('span');
            let count = parseInt(countSpan.textContent);
            btn.classList.toggle('active');
            // Qui servirebbe FontAwesome per cambiare icona far/fas
            countSpan.textContent = btn.classList.contains('active') ? count + 1 : count - 1;
            if(btn.classList.contains('active')) {
                btn.querySelector('i').className = 'fas fa-heart'; // Cuore pieno
            } else {
                btn.querySelector('i').className = 'far fa-heart'; // Cuore vuoto
            }
        } else if (e.target.closest('.btn-reply')) {
            // Logica Risposta (mostra form di risposta)
            alert('Funzionalit√† Risposta non implementata.');
        }
    });

    // Inizializza stato prenotazione e Lightbox
    document.addEventListener('DOMContentLoaded', () => {
        updateBookingStatus();
        lightbox.option({ // Opzioni Lightbox
            'resizeDuration': 200,
            'wrapAround': true
        });
    });

</script>
</html>